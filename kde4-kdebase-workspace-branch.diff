--- workspace/kcontrol/randr/outputconfig.cpp	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/kcontrol/randr/outputconfig.cpp	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -45,6 +45,8 @@
 	connect(m_output, SIGNAL(outputChanged(RROutput, int)),
 	        this,     SLOT(outputChanged(RROutput, int)));
 		  
+	load();
+
 	connect(sizeCombo,    SIGNAL(currentIndexChanged(int)), this, SLOT(setConfigDirty()));
 	connect(refreshCombo, SIGNAL(currentIndexChanged(int)), this, SLOT(setConfigDirty()));
 	connect(orientationCombo, SIGNAL(currentIndexChanged(int)), this, SLOT(setConfigDirty()));
@@ -63,7 +65,6 @@
 	updatePositionListTimer.setSingleShot( true );
 	connect( &updatePositionListTimer, SIGNAL( timeout()), SLOT( updatePositionListDelayed()));
 
-	load();
 }
 
 OutputConfig::~OutputConfig()
@@ -294,6 +295,9 @@
 
 void OutputConfig::updatePositionListDelayed()
 {
+	disconnect(positionCombo,    SIGNAL(currentIndexChanged(int)), this, SLOT(setConfigDirty()));
+	disconnect(positionOutputCombo,    SIGNAL(currentIndexChanged(int)), this, SLOT(setConfigDirty()));
+
 	bool enable = !resolution().isEmpty();
 	positionCombo->setEnabled( enable );
 	positionLabel->setEnabled( enable );
@@ -338,6 +342,9 @@
 		if(index != -1)
 			positionOutputCombo->setCurrentIndex(index);
 	}*/
+
+	connect(positionCombo,    SIGNAL(currentIndexChanged(int)), this, SLOT(setConfigDirty()));
+	connect(positionOutputCombo,    SIGNAL(currentIndexChanged(int)), this, SLOT(setConfigDirty()));
 }
 
 void OutputConfig::updateRotationList(void)
--- workspace/doc/klipper/index.docbook	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/doc/klipper/index.docbook	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -30,8 +30,8 @@
 
 <legalnotice>&FDLNotice;</legalnotice>
 
-<date>2005-01-31</date>
-<releaseinfo>2.92.00</releaseinfo>
+<date>2010-01-14</date>
+<releaseinfo>0.9.7 (&kde; 4.4)</releaseinfo>
 
 <abstract>
 <para>&klipper; is the &kde; clipboard cut &amp; paste utility.</para>
@@ -49,10 +49,8 @@
 <title>Introduction</title>
 <para>&klipper; is the &kde; clipboard utility. It stores clipboard
 history, and allows you to link clipboard contents to application
-actions. Please report any problems or feature requests to Esben Mose
-Hansen (see <ulink
-url="http://mosehansen.dk/about">http://mosehansen.dk/about</ulink>
-for contact details).</para>
+actions. Please report any problems or feature requests to<ulink
+url="http://bugs.kde.org">KDEs bugzilla</ulink> or use the "report bug" feature.</para>
 
 </chapter>
 
@@ -89,9 +87,9 @@
 open, press <keycombo action="simul">&Alt;<keycap>L</keycap>
 </keycombo>.</para>
 
-<para>To remove &klipper;, click on the handle next to it (a small
-black triangle), and from the menu that appears, select
-<guimenuitem>Remove Klipper</guimenuitem>.</para>
+<para>To disable &klipper;, click on its icon and 
+from the menu that appears, select
+<guimenuitem>Quit</guimenuitem>.</para>
 
 </sect1>
 
@@ -101,30 +99,35 @@
 <para>&klipper; can perform actions on the contents of the clipboard,
 based on whether they match a particular regular expression. For
 example, any clipboard contents starting with <quote>http://</quote> can
-be passed to &Netscape; or &konqueror; as &URL;s to open.</para>
+be passed to Firefox or &konqueror; as &URL;s to open. In addition, if the 
+contents matches a path, similar actions can be performed according to the file's
+type. E.g, if the path to a pdf file is copied to the clipboard, the file can be 
+view in Okular</para>
 
-<para>To use this feature, just copy a &URL; or filename to the
-clipboard. If there is a matching regular expression in &klipper;'s
-list, a menu will appear showing you the options you have (&eg; Open
-&URL; in &konqueror;, open &URL; in &Netscape;). Use the mouse or
-keyboard to select the option you want, and &klipper; will run the
-program you have selected, opening the address pointed to by the
-clipboard contents.</para>
+<para>To use this feature, just select a &URL; or path. <!-- starting with slash ?-->
+If there is a matching regular expression in &klipper;'s
+list, a menu will appear showing you the programs for your selection. 
+Use the mouse or cursor keys to select a program, and &klipper; will run 
+this program, opening the address pointed to by the
+selection.</para>
 
 <para>If you do not want to perform any actions on the clipboard
-contents, select <guimenuitem>Do Nothing</guimenuitem> on the pop-up menu
+contents, select <guimenuitem>Disable This Popup</guimenuitem> on the pop-up menu
 to return to what you were doing before. If you leave the menu, it will
 disappear, leaving you to continue your work. You can change the time
 that the menu remains for in the <guilabel>Configure Klipper...</guilabel>
-dialog, with the option <guilabel>Timeout for action pop-ups</guilabel>
-under the <guilabel>General</guilabel> tab.</para>
-	  
+dialog, with the option <guilabel>Timeout for action popups</guilabel>
+under the <guilabel>General</guilabel> tab. You can separately disable the 
+file path part using the option <guilabel>Enable MIME-based actions</guilabel> under
+the <guilabel>Actions</guilabel> tab.</para>
+  
 <para>Actions can be disabled completely by clicking on &klipper; and
-selecting <guimenuitem>Actions Enabled</guimenuitem>, or by pressing
+deselecting <guimenuitem>Actions Enabled</guimenuitem>, or by pressing
 <keycombo action="simul">&Ctrl;&Alt;<keycap>X</keycap></keycombo>.</para>
 
 <para>Clipboard contents which match a regular expression can also be
-edited before performing an action on them. Select <guimenuitem>Edit contents...</guimenuitem> on the &klipper; pop-up menu, and you can
+edited before performing an action on them. Select <guimenuitem>Edit 
+contents...</guimenuitem> on the &klipper; pop-up menu, and you can
 change the clipboard contents in the dialog which appears, before
 clicking the <guibutton>OK</guibutton> button to run the appropriate
 action.</para>
@@ -178,10 +181,11 @@
 <sect2 id="changing-clipboard-modes">
 <title>Changing Clipboard/Selection Behavior</title>
 <para>
+<!-- this has changed in kde 4.4-->
 In order to change clipboard/selection behavior, select
-<guimenuitem>Configure Klipper...</guimenuitem> from the &klipper; pop-up menu,
+<guimenuitem>Configure &klipper;...</guimenuitem> from the &klipper; pop-up menu,
 and in the dialog box that appears, select the
-<guilabel>General</guilabel> tab. Selecting <guilabel>Separate clipboard and
+<guilabel>General</guilabel> tab. Unchecking <guilabel>Synchronize contents of the clipboard and the
 selection</guilabel> makes the clipboard and selection function as completely
 separate buffers as described above. With this option set, the option
 <guilabel>Ignore selection</guilabel> will prevent &klipper; from
@@ -243,13 +247,10 @@
 </varlistentry>
 
 <varlistentry>
-<term><guilabel>Remove white space when executing actions</guilabel></term>
-<listitem><para>If selected, any white space (spaces, tabs, &etc;) at the
-beginning and end of the clipboard contents will be removed before passing the
-clipboard contents to an application. This is useful, for example, if the
-clipboard contains a &URL; with spaces which, if opened by a web browser, would
-cause an error.</para>
-</listitem>
+<term><guilabel>Prevent empty clipboard</guilabel></term>
+<listitem><para>If selected, the clipboard will never be empty: &klipper; will
+insert the most recent item from the clipboard history into the clipboard
+instead of allowing it to be empty.</para></listitem>
 </varlistentry>
 
 <varlistentry>
@@ -262,36 +263,59 @@
 </varlistentry>
 
 <varlistentry>
-<term><guilabel>Prevent empty clipboard</guilabel></term>
-<listitem><para>If selected, the clipboard will never be empty: &klipper; will
-insert the most recent item from the clipboard history into the clipboard
-instead of allowing it to be empty.</para></listitem>
+<term><guilabel>Remove white space when executing actions</guilabel></term>
+<listitem><para>If selected, any white space (spaces, tabs, &etc;) at the
+beginning and end of the clipboard contents will be removed before passing the
+clipboard contents to an application. This is useful, for example, if the
+clipboard contains a &URL; with spaces which, if opened by a web browser, would
+cause an error.</para>
+</listitem>
 </varlistentry>
 
 <varlistentry>
+<term><guilabel>Ignore images</guilabel></term>
+<listitem><para>When an area of the screen is selected with mouse or keyboard, 
+this is called the <quote>selection</quote>. If this option is selected, only text 
+selections are stored in the history, while images and other selections are not.
+</para>
+</listitem>
+</varlistentry> 
+
+<varlistentry>
 <term><guilabel>Ignore selection</guilabel></term>
-<listitem><para>Sets the clipboard mode. See <xref linkend="clipboard-modes"/>.
+<listitem><para>Sets the clipboard mode. This option will prevent &klipper; from
+including the contents of the selection in its clipboard history and from
+performing actions on the contents of the selection. See <xref linkend="clipboard-modes"/>.
 </para>
 </listitem>
 </varlistentry> 
 
-
 <varlistentry>
-<term><guilabel>Synchronize contents of the clipboard and the
-selection</guilabel></term>
-<listitem><para>Sets the clipboard mode. See <xref linkend="clipboard-modes"/>.
+<term><guilabel>Text selection only</guilabel></term>
+<listitem><para>When an area of the screen is selected with mouse or keyboard, this is 
+called the <quote>selection</quote>. If this option is selected, only text selections 
+are stored in the history, while images and other selections are not.
+See <xref linkend="clipboard-modes"/>.
 </para>
 </listitem>
 </varlistentry> 
 
 <varlistentry>
-<term><guilabel>Separate clipboard and selection</guilabel></term>
-<listitem><para>Sets the clipboard mode. See <xref linkend="clipboard-modes"/>.
+<term><guilabel>Synchronize contents of the clipboard and the
+selection</guilabel></term>
+<listitem><para>Sets the clipboard mode. 
+When an area of the screen is selected with mouse or keyboard, this is 
+called the <quote>selection</quote>. If this option is selected, the selection and the 
+clipboard is kept the same, so that anything in the selection is immediately 
+"available for pasting elsewhere using any method, including the traditional 
+middle mouse button. Otherwise, the selection is recorded in the clipboard 
+history, but the selection can only be pasted using the middle mouse button. 
+Also see the <guilabel>Ignore selection</guilabel> option. 
+See <xref linkend="clipboard-modes"/>.
 </para>
 </listitem>
 </varlistentry> 
 
-
 <varlistentry>
 <term><guilabel>Timeout for Action pop-ups</guilabel></term>
 <listitem><para>Set the time that a popup menu will remain for if you do
@@ -317,7 +341,7 @@
 <listitem><para>On the <guilabel>Actions</guilabel> tab, double-click
 the regular expression or action that you want to edit. An in-place text editing
 box will appear in which the text can be edited as you wish. Make sure you
-press <keysym>Enter</keysym> when you are done.</para></listitem>
+press &Enter; when you are done.</para></listitem>
 </varlistentry>
 
 <varlistentry>
@@ -344,15 +368,15 @@
 
 <para>Note that <token>%s</token> in the command line is replaced with
 the clipboard contents, &eg; if your command definition is
-<userinput><command>kedit</command> <token>%s</token></userinput> and
+<userinput><command>kwrite</command> <token>%s</token></userinput> and
 your clipboard contents are <filename>/home/phil/textfile</filename>,
-the command <userinput><command>kedit</command>
+the command <userinput><command>kwrite</command>
 <filename>/home/phil/textfile</filename></userinput> will be run. To
 include <token>%s</token> in the command line, escape it with a
 backslash, as so: <userinput>\%s</userinput>.</para></listitem>
 </varlistentry>
 
-<varlistentry><term><guibutton>Advanced...</guibutton></term>
+<varlistentry><term><guibutton>Advanced</guibutton></term>
 <listitem><para>Brings up the <guilabel>Disable Actions for windows of type
 WM_CLASS</guilabel> dialog.</para>
 <para>Some programs, such as &konqueror;,
@@ -398,9 +422,9 @@
 <varlistentry>
 <term><guilabel>Custom</guilabel></term>
 <listitem><para>The selected action is assigned to the keys you choose.</para>
-<para>To choose a custom key for the action you have selected, click on the
-representation of a key in the lower right of the screen to activate it, and
-type the desired key combination on your keyboard, as in any &kde; application. 
+<para>To choose a custom key for the action you have selected, click on 
+<guilabel>Custom</guilabel> and then <guilabel>None</guilabel>.
+Now type the desired key combination on your keyboard, as in any &kde; application. 
 </para> </listitem>
 </varlistentry>
 </variablelist>
@@ -447,12 +471,7 @@
 
 <sect1 id="compilation">
 <title>Compilation and Installation</title>
-<para>&klipper; should compile and install along with the kdebase
-package, and appear on your &kde; panel (&kicker;) when you run &kde;
-3. If it does not appear, you can start it by selecting
-<guimenuitem>Add Applet to Panel...</guimenuitem> 
-in any context menu in &kicker;, the &kde; Panel 
-and choosing <guilabel>Klipper</guilabel> in the dialog.</para> 
+&install.compile.documentation; 
 
 <screenshot>
 <screeninfo>&klipper; icon</screeninfo>
--- workspace/doc/kcontrol/kwinscreenedges/index.docbook	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/doc/kcontrol/kwinscreenedges/index.docbook	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -14,12 +14,12 @@
 <!-- TRANS:ROLES_OF_TRANSLATORS -->
 </authorgroup>
 
-<date>2009-11-17</date>
+<date>2010-02-04</date>
 <releaseinfo>&kde; 4.4</releaseinfo>
 
 <keywordset>
 <keyword>KDE</keyword>
-<keyword>KControl</keyword>
+<keyword>Systemsettings</keyword>
 <keyword>desktop</keyword>
 <keyword>effects</keyword>
 </keywordset>
@@ -34,12 +34,19 @@
 in the context menu. Edges with a black square have already an attached effect, 
 a grey colored square indicates that no effect is selected for this edge.</para>
 
-<!-- apparently not in kde4
+<para>The number of accessible items in the context menu depends on the settings in the module
+<menuchoice><guilabel>Look &amp; Feel</guilabel> <guilabel>Desktop</guilabel>
+</menuchoice> on the <ulink url="help:/kcontrol/kwincompositing/index.html">
+<guilabel>Desktop Effects</guilabel></ulink> page. Select <guilabel>Enable desktop 
+effects</guilabel> to activate compositing, select the compositing type 
+<guilabel>OpenGL</guilabel>, and then choose your favorite effects on the 
+<guilabel>All Effects</guilabel> tab from the <guilabel>Windows Management</guilabel> 
+group. This activates the corresponding items in the context menu.</para>
+
 <para>If you are looking for the setting to enable switching of desktops by 
 pushing your mouse cursor against the edge of the screen you can find it in 
-the settings module <ulink url="help:/kcontrol/windowbehaviour/index.html#action-advanced">
-<guilabel>Window Behavior</guilabel></ulink> on the <guilabel>Advanced</guilabel> 
-tab in the section <guilabel>Active Desktop Borders</guilabel>.
-</para>
--->
+the settings module <menuchoice><guilabel>Look &amp; Feel</guilabel> <guilabel>Window 
+Behaviour</guilabel></menuchoice> on the <ulink url="help:/kcontrol/kwintabbox/index.html">
+<guilabel>Navigate Through Windows</guilabel></ulink> page.</para>
+
 </article>
--- workspace/doc/kcontrol/mouse/index.docbook	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/doc/kcontrol/mouse/index.docbook	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -174,9 +174,8 @@
 whereas larger movements of the physical device will move the mouse
 pointer rapidly to different areas on the screen.</para>
 
-<para>You can set the threshold value by dragging the slider button or
-by clicking the up/down arrows on the spin-button to the left of the
-slider.</para>
+<para>You can set the threshold by entering a value into the edit box or
+by clicking the up/down arrows to the right of the box.</para>
 
 <tip><para>In general, the higher you set the <guilabel>Pointer
 acceleration</guilabel> value, the higher you will want to set the
--- workspace/doc/kcontrol/clock/index.docbook	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/doc/kcontrol/clock/index.docbook	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -43,7 +43,12 @@
 <sect2 id="date-change">
 <title><guilabel>Date and Time</guilabel> tab</title>
 
-<para>You set the date using the left half of the tab.  Simply
+<para>If you check <guilabel>Set date and time automatically</guilabel> you are able
+to select a <guilabel>Time server</guilabel> from the drop down box and all other 
+settings in this dialog are disabled.</para>
+
+<para>If you do not use a time server, you are able to set the date manually 
+using the left half of the tab.  Simply
 choose your month and year using the controls at the top of the calendar
 and the day of the month by clicking on the day in the
 calendar.</para>
@@ -67,12 +72,6 @@
 <para>To set a new time zone, simply select your area from the list below.</para>
 </sect2>
 
-<sect2 id="date-ntp">
-<title><guilabel>NTP</guilabel> tab</title>
-<para>If you check <guilabel>Set date and time automatically</guilabel> you are able
-to select a <guilabel>Time server</guilabel> from the drop down box.</para>
-</sect2>
-
 </sect1>
 
 </article>
--- workspace/doc/kcontrol/kcmaccess/index.docbook	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/doc/kcontrol/kcmaccess/index.docbook	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -97,7 +97,8 @@
 <sect3 id="access-modifier-keys">
 <title><guilabel>Modifier keys</guilabel></title>
 
-<para>There are two sections to this panel.</para>
+<para>There are the two sections <guilabel>Sticky Keys</guilabel>
+and <guilabel>Locking Keys</guilabel> to this panel.</para>
 
 <variablelist>
 <varlistentry>
--- workspace/doc/kcontrol/desktopthemedetails/index.docbook	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/doc/kcontrol/desktopthemedetails/index.docbook	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -13,77 +13,80 @@
 <!-- TRANS:ROLES_OF_TRANSLATORS -->
 </authorgroup>
 
-<date>2009-05-18</date>
-<releaseinfo>0.9</releaseinfo>
+<date>2010-01-20</date>
+<releaseinfo>1.0</releaseinfo>
 
 <keywordset>
 <keyword>KDE</keyword>
 <keyword>System Settings</keyword>
 <keyword>desktop</keyword>
 <keyword>theme</keyword>
+<keyword>plasma</keyword>
 </keywordset>
 </articleinfo>
 
 <sect1 id="kcm_desktopthemedetails">
 <title><guilabel>Desktop Theme Details</guilabel></title>
 
-<para>The KDE plasma desktop theme is made up of several components or items.  This 
-module allows you to customize your desktop Plasma theme and to replace theme items 
+<para>A &kde; plasma desktop theme is made up of several components or items,
+consisting mostly in svg backgrounds and colors schemes. This module allows you
+to customize your desktop Plasma theme and to replace theme items 
 with items from other themes or from files.
 </para>
-<para>Desktop theme items consist in panel theme item, kickoff theme item,... all in default
-theme.</para>
+
+<para>Desktop theme items consist in panel theme item, kickoff theme item,
+analog clock, ...</para>
+
+<note><para>
+If you want to change your current theme for a full new theme (for example from
+Air to Glassified) then you can do so in <interface>System Settings -&gt;
+General -&gt; Appearance -&gt; Style -&gt; Workspace tab</interface>.
+</para></note>
+
 <sect2 id="start">
 <title>Quick start</title>
 <para>First download one or several themes you want to use to customize your 
-desktop items by clicking the <guibutton>Get New Theme...</guibutton> button.</para>
-<para>You can then start customizing each item you want to change with a new theme, 
-for example you can have the panel in Glassified theme, ...</para>
-<para>When you have finished, click the <guibutton>Apply</guibutton> button. You will then get an information 
-message that tells you to enable the <guilabel>(Customized)</guilabel> theme on the 
-Desktop settings dialog.</para>
+desktop items by clicking the <guibutton>Get New Theme...</guibutton>
+button in <interface>System Settings -&gt;
+General -&gt; Appearance -&gt; Style -&gt; Workspace tab</interface>.</para>
 
+<para>All the available themes will be displayed on top, the current one being highlighted.</para>
+
+<para>In the theme list, select a base theme that will be used for most widgets and start
+customizing each item you want to change with a new theme, for example you can
+have the panel in Glassified theme, the widget
+backgrounds in Air and so on.</para>
+
+<para>Here Air is the theme for most widgets and we changed the panel background
+to Glassified, the Analog clock to Glassified and the Notes to Oxygen.</para>
+
 <para>
 <screenshot>
-<screeninfo>The information message</screeninfo>
+<screeninfo>Customizing your plasma theme</screeninfo>
   <mediaobject>
     <imageobject>
-      <imagedata fileref="message.png" format="PNG"/>
+      <imagedata fileref="customizing.png" format="PNG"/>
     </imageobject>
     <textobject>
-      <phrase>The information message</phrase>
+      <phrase>Customizing your plasma theme</phrase>
     </textobject>
   </mediaobject>
 </screenshot>
 </para>
 
-<para>You then need to change the Desktop settings to <guilabel>(Customized)</guilabel> 
-in order for the theme details to be applied to your desktop.</para>
-
 <para>
-<screenshot>
-<screeninfo>Desktop Settings Dialog</screeninfo>
-  <mediaobject>
-    <imageobject>
-      <imagedata fileref="desktop-settings.png" format="PNG"/>
-    </imageobject>
-    <textobject>
-      <phrase>Desktop Settings Dialog</phrase>
-    </textobject>
-  </mediaobject>
-</screenshot>
+Clicking the <guibutton>Apply</guibutton> will create a new theme named
+<guilabel>(Customized)</guilabel> and will apply it to your desktop.
 </para>
-
-<para>Click the <guibutton>Apply</guibutton> button on the dialog above to get the desktop settings applying your 
-new choice.</para>
 </sect2>
 
 <sect2 id="custom">
 <title>Creating a custom theme</title>
-<para>When the module is opened, it will show items from the current desktop theme. 
-If you would like to start customizing with a different theme, select it from 
-the drop box above the list of theme items. This theme from the drop box is the starting 
-theme, the base for your new customized desktop theme.</para>
+<para>When the module is opened, it will show items from the current desktop
+theme. If you would like to start customizing with a different theme, select it
+from 
+the drop box above the list of theme items. This theme from the drop box is the
+starting theme, the base for your new customized desktop theme.</para>
 
 <para>
 In the list of items, for each item you would like to replace, select 
@@ -94,11 +97,25 @@
 </para>
 
 <para>
-Click <guibutton>Apply</guibutton> when all the changes have been made.  This will create a new 
-theme named <guilabel>(Customized)</guilabel> which you can select from the Appearance Settings 
-dialog on the desktop.
+Click <guibutton>Apply</guibutton> when all the changes have been made.  This
+will create a new theme named <guilabel>(Customized)</guilabel> which you can
+select from the Appearance Settings dialog on the desktop.
 </para>
 
+<para>
+<screenshot>
+<screeninfo>Your custom theme</screeninfo>
+  <mediaobject>
+    <imageobject>
+      <imagedata fileref="clicking-apply.png" format="PNG"/>
+    </imageobject>
+    <textobject>
+      <phrase>Customized</phrase>
+    </textobject>
+  </mediaobject>
+</screenshot>
+</para>
+
 <note><para>
 The theme items listed are the most visible components of the plasma 
 desktop theme.  Other theme components are not listed.  Your newly created 
@@ -110,9 +127,11 @@
 <sect2 id="naming">
 <title>Naming a custom theme</title>
 <para>
-To provide a name for your customized theme, click on the <guilabel>More</guilabel> checkbox and 
+To provide a name for your customized theme, click on the
+<guilabel>More</guilabel> checkbox and 
 enter the name of the theme.  You may also provide your name (author), a theme 
-version and a description of your theme.  Click <guibutton>Apply</guibutton> when done.
+version and a description of your theme.  Click <guibutton>Apply</guibutton>
+when done.
 </para>
 </sect2>
 
@@ -120,7 +139,8 @@
 <title>Removing a theme</title>
 <para>
 Select the theme you would like to remove from the drop box above the list of 
-theme items. Click on the <guilabel>More</guilabel> check box. Click the <guibutton>Remove Theme</guibutton> button to 
+theme items. Click on the <guilabel>More</guilabel> check box. Click the
+<guibutton>Remove Theme</guibutton> button to 
 remove the selected theme.
 </para>
 </sect2>
@@ -130,8 +150,10 @@
 <para>
 You can share your newly customized theme with the community by exporting the 
 theme to a file. Select your customized theme from the drop box above the list 
-of theme items.  Click on the <guilabel>More</guilabel> check box.  Click the <guibutton>Export Theme to 
-File...</guibutton>.  Enter the name of the zip file to which the theme will be saved.
+of theme items.  Click on the <guilabel>More</guilabel> check box.  Click the
+<guibutton>Export Theme to 
+File...</guibutton>.  Enter the name of the zip file to which the theme will be
+saved.
 </para>
 </sect2>
 
--- workspace/doc/kcontrol/fontinst/index.docbook	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/doc/kcontrol/fontinst/index.docbook	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -94,7 +94,7 @@
 <sect2 id="font-preview">
 <title>Preview</title>
 <para>This displays a preview text in different font sizes.</para>
-<para>Using the context menu enables you to zoom in and out, select a preview type (<guilabel>Standard Preview</guilabel>, <guilabel>All Characters</guilabel>, &etc;) and change the preview text.</para>
+<para>Using the context menu enables you to zoom in and out, select a preview type (<guilabel>Standard Preview</guilabel> or <guilabel>All Characters</guilabel>) and change the preview text.</para>
 </sect2>
 </sect1>
 </article>
--- workspace/doc/kcontrol/kwintabbox/index.docbook	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/doc/kcontrol/kwintabbox/index.docbook	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -11,7 +11,7 @@
 <!-- TRANS:ROLES_OF_TRANSLATORS -->
 </authorgroup>
 
-<date>2009-09-22</date>
+<date>2010-02-04</date>
 <releaseinfo>&kde; 4.4</releaseinfo>
 
 <keywordset>
@@ -26,28 +26,32 @@
 <sect1 id="windows-navigating">
 <title>Navigating through Windows</title>
 
-<para>This module offers the possibility to configure the behaviour for Navigating through windows often referred to as Alt+Tab. There are two independent lists which can have different settings. For each of this list there is an own tab in this module. 
+<para>This module offers the possibility to configure the behaviour for Navigating through windows often referred to as <keycombo>&Alt;&Tab;</keycombo>. There are two independent sets of effects which can have different settings. For each of this sets  there is an own tab (<guilabel>General</guilabel> and <guilabel>Alternative</guilabel>) in this module. 
 </para>
 
 <note><para>
-If you want to use the second list, you have to set a shortcut in the Shortcut Editor manually.</para></note>
+The first set of effects on the <guilabel>General</guilabel> tab has predefined shortcuts. If you want to use the second set of effects on the <guilabel>Alternative</guilabel> tab, you have to set a shortcut for these effects in the Shortcut Editor manually.</para></note>
 
+<para>The following documentation of options applies to the general settings and the alternative settings as well.</para>
+
 <sect2 id="sort-order">
-<title>Sort order</title>
-<para>You can configure which windows should be shown in the list initiated by pressing Alt+Tab. So it is possible to only show windows on the current desktop or windows from all desktops. It is also possible to influence the sort order, you can either use a sort order based on the last usage of the windows or the stacking order of the windows.
+<title>List windows and Sort order</title>
+<para>You can configure which windows should be shown in the list initiated by pressing <keycombo>&Alt;&Tab;</keycombo> (predefined for the settings on the <guilabel>General</guilabel> tab) or the user defined shortcut for the alternative settings. So it is possible to only show windows on the current desktop or windows from all desktops. It is also possible to influence the sort order, you can either use a sort order based on the last usage of the windows or the stacking order of the windows.
 </para>
 </sect2>
 
 <sect2 id="desktop-effects">
 <title>Desktop Effects</title>
 <para>
-There are several effects which can be used instead of the normal window list when compositing is enabled. By default the "Box Switch Effect" is used. This effect displays a small thumbnail of each window inside a box and the currently selected window is highlighted.
+There are several effects which can be used instead of the normal window list when compositing is enabled. By default the <guilabel>Box Switch</guilabel> effect is used. This effect displays a small thumbnail of each window inside a box and the currently selected window is highlighted.
 </para>
 <para>
-The Present Windows Effect arranges the windows in a regular grid and by that provides thumbnails in the best possible size. This effect can be used without Alt+Tab as well and provides additional shortcuts and screen corner actions.
+The <guilabel>Present Windows</guilabel> effect arranges the windows in a regular grid and by that provides thumbnails in the best possible size. This effect can be used for navigating through windows without <keycombo>&Alt;&Tab;</keycombo> as well, if it is selected as screen edge action in the systemsettings module <menuchoice><guilabel>Look &amp; Feel</guilabel> <guilabel>Desktop
+</guilabel></menuchoice> on the <ulink url="help:/kcontrol/kwinscreenedges/index.html">
+<guilabel>Screen Edges</guilabel></ulink> page. This effect provides additional setting options and shortcuts in a dialog opened by clicking on the tools icon beside the drop down box.
 </para>
 <para>
-Cover Switch and Flip Switch Effect are more fancy effects which require OpenGL. Cover Switch displays the windows in a gallery with a large thumbnail of the currently selected window in the center of the screen while all other windows are rotated on the left and right. Flip Switch displays all windows on a 3D stack. The selected window is on top of the stack and navigating through the windows will move the stack so that the new selected window is on the top.
+<guilabel>Cover Switch</guilabel> and <guilabel>Flip Switch</guilabel> effect are more fancy effects which require OpenGL. <guilabel>Cover Switch</guilabel> displays the windows in a gallery with a large thumbnail of the currently selected window in the center of the screen while all other windows are rotated on the left and right. <guilabel>Flip Switch</guilabel> displays all windows on a 3D stack. The selected window is on top of the stack and navigating through the windows will move the stack so that the new selected window is on the top.
 </para>
 <para>
 If the effect provides additional settings the configure button will be activated. By clicking this button a configuration dialog will be shown.
@@ -57,12 +61,12 @@
 </sect2>
 
 <sect2 id="lists">
-<title>List</title>
+<title>Displays list</title>
 <para>
-When no effect is used an outline illustrating position and size of the selected window can be shown. The list can be combined with the Highlight Windows Effect when compositing is active. This effect will highlight the currently selected window by fading out all other windows.
+When no effect is used an outline illustrating position and size of the selected window can be shown. The list can be combined with the <guilabel>Highlight selected windows</guilabel> effect when compositing is active. This effect will highlight the currently selected window by fading out all other windows.
 </para>
 <para>
-If you want to configure the layout of one item you can use the dialog which opens by clicking "Configure layout". There are several predefined layouts which provide an informative or compact view, small or large icons and window title only. You can change the way the items are laid out: horizontal, vertical or in a tabular layout. At the bottom of the dialog there is a live preview for the current settings.
+If you want to configure the layout of one item you can use the dialog which opens by clicking <guibutton>Configure Layout</guibutton>. There are several predefined layouts which provide an informative or compact view, small or large icons and window title only. You can change the way the items are laid out: horizontal, vertical or in a tabular layout. At the bottom of the dialog there is a live preview for the current settings.
 </para>
 <para>
 There is an additional configuration group for an optional view of the selected item. It is possible to place this view next to the list with all items. This is useful if you use an icon only layout mode and want to see the name of the current selected window as well.
@@ -72,7 +76,7 @@
 <sect2 id="shortcuts">
 <title>Shortcuts</title>
 <para>
-The shortcut editor provides the configuration interface for the keyboard shortcuts for navigating through windows. Each of the two possible lists has two shortcuts: one for the forward direction and one for the reverse direction. Please note that the list can only be shown if you select a shortcut with a keyboard modifier such as the Alt or Control key. This modifier has to be hold while switching. Selecting a shortcut without a modifier key can break the behaviour of navigating through windows.
+The shortcut editor provides the configuration interface for the keyboard shortcuts for navigating through windows. Each of the two possible sets of effects has two shortcuts: one for the forward direction and one for the reverse direction. Please note that the window list can only be shown if you select a shortcut with a keyboard modifier such as the &Alt; or &Ctrl; key. This modifier has to be hold while switching. Selecting a shortcut without a modifier key can break the behaviour of navigating through windows.
 </para>
 </sect2>
 
--- workspace/doc/kcontrol/keys/index.docbook	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/doc/kcontrol/keys/index.docbook	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -75,10 +75,11 @@
 <title><guilabel>Standard Keyboard Shortcuts</guilabel> tab</title>
 <para>At the bottom of this dialog you see an input box, where you can
 search interactively for shortcut names (&eg; Copy) or combination of keys 
-(&eg; Ctrl+C) by typing them here.</para>
+(&eg; <keycombo action="simul">&Ctrl;<keycap>C</keycap> </keycombo>) by typing them here.</para>
 <para>Below the search box you can see a list of key bindings, &ie; associations between actions 
-(&eg; Copy) shown in the <guilabel>Actions</guilabel> column and keys or combination of keys (&eg;
-Ctrl+V) shown in the <guilabel>Shortcut</guilabel> or <guilabel>Alternate</guilabel> column.
+(&eg; Copy) shown in the <guilabel>Actions</guilabel> column and keys or combination of keys 
+(&eg; <keycombo action="simul">&Ctrl;<keycap>C</keycap> </keycombo>) shown in the 
+<guilabel>Shortcut</guilabel> or <guilabel>Alternate</guilabel> column.
 </para>
 <!-- Global column is empty what's that???-->
 </sect3>
@@ -106,7 +107,7 @@
 configure.</para>
 
 <para>After you have selected an action in the list you will notice that 
-this item is displayed bold and you see two additional check boxes below 
+this item is highlighted and you see two additional check boxes below 
 this item in the list view. There you can configure a
 combination of keys or maybe no key binding at all for the selected
 action. </para>
@@ -123,10 +124,10 @@
 action. Click on the button labeled either <guibutton>None</guibutton> 
 or labeled with the previously selected custom shortcut. Now the button label
 changes to <guibutton>Input</guibutton>. Then press any modifier key 
-(&ie; &Shift;, &Ctrl;, or &Alt;) and then normal key or a function key (&eg; F11) 
+(&ie; &Shift;, &Ctrl;, or &Alt;) and then normal key or a function key (&eg; <keycap>F11</keycap>) 
 you want to assign to this key combination.</para>
-<para>Clicking on the <guilabel>Alternate</guilabel> column of the selected row
-allows to edit this shortcut for the action.</para></listitem>
+<para>Clicking on the <guilabel>Alternate</guilabel> column of a row in the list
+allows to edit the second shortcut for the action.</para></listitem>
 </itemizedlist>
 
 </sect3>
--- workspace/doc/kdm/index.docbook	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/doc/kdm/index.docbook	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -341,19 +341,20 @@
 
 <para>You can view the &kdmrc; file currently in use on your system, and you
 can configure &kdm; by editing this file. Alternatively, you can use the
-graphical configuration tool provided by the &kcontrolcenter; (under
-<menuchoice><guisubmenu>System Administration</guisubmenu><guimenuitem>Login
-Manager</guimenuitem></menuchoice>).
+graphical configuration tool provided by the &systemsettings; (under
+<menuchoice><guisubmenu>System</guisubmenu><guimenuitem>Login
+Manager</guimenuitem></menuchoice> on the <guilabel>Advanced</guilabel> tab).
 </para>
 
 <para>The remainder of this chapter describes configuration of &kdm;
-via the &kcontrolcenter; module, and the <link linkend="kdm-files">next
+via the &systemsettings; module, and the <link linkend="kdm-files">next
 chapter</link> describes the options available in &kdmrc; itself. If
-you only need to configure for local users, the &kcontrolcenter; module
+you only need to configure for local users, the &systemsettings; module
 should be sufficient for your needs.  If you need to configure remote
 logins, or have multiple &kdm; sessions running, you will need to read
 on.</para>
 
+<!-- this sect is up to date for 4.4-->
 <sect1 id="kdm-kcontrol-module">
 <sect1info>
 <authorgroup>
@@ -363,7 +364,7 @@
 </authorgroup>
 </sect1info>
 
-<title>The Login Manager &kcontrolcenter; Module</title>
+<title>The Login Manager &systemsettings; Module</title>
 
 <para>Using this module, you can configure the &kde; graphical login
 manager, &kdm;.  You can change how the login screen looks, who has
@@ -372,7 +373,7 @@
 
 <note><para>All settings will be written to the configuration file
 &kdmrc;, which in its original state has many comments to help you
-configure &kdm;.  Using this &kcontrolcenter; module will strip these
+configure &kdm;.  Using this &systemsettings; module will strip these
 comments from the file.  All available options in &kdmrc; are covered
 in <xref linkend="kdm-files"/>.</para>
 
@@ -381,14 +382,14 @@
 module are also available directly in &kdmrc; but the reverse is not
 true.</para></note>
 
-<!-- XXX Totally outdated stuff starts here. XXX -->
-
 <para>In order to organize all of these options, this module is
 divided into several sections: <link
-linkend="kdmconfig-appearance"><guilabel>Appearance</guilabel></link>,
-<link linkend="kdmconfig-font"><guilabel>Font</guilabel></link>, <link
+linkend="kdmconfig-general"><guilabel>General</guilabel></link>,
+<link linkend="kdmconfig-dialog"><guilabel>Dialog</guilabel></link>, <link
 linkend="kdmconfig-background"><guilabel>Background</guilabel></link>,
 <link
+linkend="kdmconfig-theme"><guilabel>Theme</guilabel></link>,
+<link
 linkend="kdmconfig-shutdown"><guilabel>Shutdown</guilabel></link>,
 <link linkend="kdmconfig-users"><guilabel>Users</guilabel></link> and
 <link
@@ -397,17 +398,63 @@
 <para>You can switch between the sections using the tabs at the top of
 the window.</para>
 
-<note><para>If you are not currently logged in as a superuser, you
-will need to click the <guibutton>Administrator Mode...</guibutton>
-Button. You will then be asked for a superuser password.  Entering a
-correct password will allow you to modify the settings of this
-module.</para></note>
+<note><para>You can only make changes if you run this module with superuser rights.</para></note>
 
-<sect2 id="kdmconfig-appearance">
-<title>Appearance</title>
+<sect2 id="kdmconfig-general">
+<title>General</title>
 
+<para>First you have a drop down box to choose the language for
+your login box, corresponding to setting <option>Language</option> in
+&kdmrc;.</para>
+
+<para>In the <guilabel>Appearance</guilabel> section you have an option to use 
+&kdm; in themed mode. If <guilabel>Use themed greeter</guilabel> is checked, 
+the settings on the <guilabel>Dialog</guilabel> and <guilabel>Background</guilabel> 
+pages cannot be configured separately.</para>
+
+<para>While &kde;'s style depends on the settings of the user logged
+in, the style used by &kdm; can be configured using the <guilabel>GUI
+style:</guilabel> and <guilabel>Color scheme:</guilabel> options.
+These correspond to the keys <link
+linkend="option-guistyle"><option>GUIStyle</option></link> and <link
+linkend="option-colorscheme"><option>ColorScheme</option></link> in
+&kdmrc; respectively.</para>
+
+<para>From the <guilabel>Fonts</guilabel> section of this page you can change the fonts used in the
+login window.  Only fonts available to all users are available here, not
+fonts you have installed on a per user basis.</para>
+
+<para>You can select three different font styles from the drop down box
+(<guilabel>General:</guilabel>, <guilabel>Failure:</guilabel>,
+<guilabel>Greeting:</guilabel>).  When you click on the
+<guibutton>Choose...</guibutton> button a dialog appears from which you can
+select the new characteristics for the font style.</para>
+
+<itemizedlist>
+<listitem>
+<para>The <guilabel>General:</guilabel> font is used in all other places in the
+login window.</para>
+</listitem>
+<listitem>
+<para>The <guilabel>Failure:</guilabel> font is used when a login
+fails.</para>
+</listitem>
+<listitem>
+<para>The <guilabel>Greeting:</guilabel> font is the font used for the title
+(Greeting String).</para>
+</listitem>
+</itemizedlist>
+
+<para>You can also check the box labeled <guilabel>Use anti-aliasing for
+fonts</guilabel> if you want smoothed fonts in the login dialog.</para>
+
+</sect2>
+
+<sect2 id="kdmconfig-dialog">
+<title>Dialog</title>
+
 <para>From this page you can change the visual appearance of &kdm;,
-&kde;'s graphical login manager.</para>
+&kde;'s graphical login manager in non themed mode.</para>
 
 <para>The <guilabel>Greeting:</guilabel> is the title of the login
  screen.  Setting this is especially useful if you have many servers users
@@ -439,71 +486,364 @@
 <filename>$<envar>KDEDIR</envar>/share/apps/kdm/pics/kdelogo.xpm</filename>
 will be displayed.</para>
 
-<para>Normally the login box is centered on the screen.  Use the
-<guilabel>Position:</guilabel> options if you want it to appear
-elsewhere on the screen.  You can specify the relative position
-(percentage of the screen size) for the center of the login window,
-relative to the top left of the display, in the fields labeled
-<guilabel>X:</guilabel> and <guilabel>Y:</guilabel> respectively.
+<para>Normally the login box is centered on the screen.  
+Drag the anchor to move the center of the dialog to the desired position. 
+Keyboard control is possible as well: Use the arrow keys or <keycap>Home</keycap> to center. 
+Note that the actual proportions of the dialog are probably different.
 These correspond to the key
 <link linkend="option-greeterpos"><option>GreeterPos</option></link>
 in &kdmrc;.</para>
 
-<para>While &kde;'s style depends on the settings of the user logged
-in, the style used by &kdm; can be configured using the <guilabel>GUI
-Style:</guilabel> and <guilabel>Color Scheme:</guilabel> options.
-These correspond to the keys <link
-linkend="option-guistyle"><option>GUIStyle</option></link> and <link
-linkend="option-colorscheme"><option>ColorScheme</option></link> in
-&kdmrc; respectively.</para>
+</sect2>
 
-<para>Below that, you have a drop down box to choose the language for
-your login box, corresponding to setting <option>Language</option> in
-&kdmrc;.</para>
+<sect2 id="kdmconfig-background">
+<title>Background</title>
 
-</sect2>
+<para>Here you can change the desktop background which will be displayed
+before a user logs in. Selecting <guilabel>Enable background</guilabel>
+allows you to edit the the options on this tab.</para>
 
-<sect2 id="kdmconfig-font">
-<title>Font</title>
+<para>This tab is comprised of three areas:</para>
 
-<para>From this section of the module you can change the fonts used in the
-login window.  Only fonts available to all users are available here, not
-fonts you have installed on a per user basis.</para>
+<orderedlist>
+<listitem>
+<para>An area for selecting background images</para>
+</listitem>
+<listitem>
+<para>The background Preview Monitor</para>
+</listitem>
+<listitem>
+<para>An area for determining the background color</para>
+</listitem>
+</orderedlist>
 
-<para>You can select three different font styles from the drop down box
-(<guilabel>General:</guilabel>, <guilabel>Failures:</guilabel>,
-<guilabel>Greeting:</guilabel>).  When you click on the
-<guibutton>Choose...</guibutton> button a dialog appears from which you can
-select the new characteristics for the font style.</para>
+<variablelist>
+<varlistentry>
+<term>Preview Monitor</term>
+<listitem>
+<para>This is a preview window.  It will give you a sense of what to
+expect with each change.</para>
+</listitem>
+</varlistentry>
 
-<itemizedlist>
+<varlistentry>
+<term><guilabel>Background</guilabel></term>
 <listitem>
-<para>The <guilabel>General:</guilabel> font is used in all other places in the
-login window.</para>
+<para>This section allows you to load a wallpaper on top of the color
+gradient chosen in the section below.</para>
+
+<para>There are three choices available here:</para>
+
+<variablelist>
+<varlistentry>
+<term><guilabel>No Picture</guilabel></term>
+<listitem>
+<para>No picture background will be shown.  The color and pattern
+choices below will still take effect.</para>
 </listitem>
+</varlistentry>
+
+<varlistentry>
+<term><guilabel>Picture</guilabel></term>
 <listitem>
-<para>The <guilabel>Failures:</guilabel> font is used when a login
-fails.</para>
+<para>A single picture will be used as the background for the selected
+desktops.</para>
+<para>How this picture is positioned and scaled can be fine tuned
+below.</para>
 </listitem>
+</varlistentry>
+
+<varlistentry>
+<term><guilabel>Slide show</guilabel></term>
 <listitem>
-<para>The <guilabel>Greeting:</guilabel> font is the font used for the title
-(Greeting String).</para>
+<para>&kde; allows you to have an automatic slide show of wallpaper
+images. To enable this option, press the <guibutton>Setup...</guibutton>
+button.  In the resulting dialog you may choose any
+image or folder of images available on your computer, using the
+<guibutton>Add...</guibutton> button to navigate your file system.
+<guibutton>Remove</guibutton> will remove the currently selected
+entry from the list.</para>
+
+<para>You may choose the length of time any image is displayed in the
+<guilabel>Change picture after:</guilabel> box, and you may choose
+<guibutton>Show pictures in random order</guibutton> if you don't want
+them displayed in the order they are listed.</para>
+
+<tip><para>Displaying wallpaper requires that the image be kept in
+memory.  If you are low on memory, using a small, tiled image or none
+at all is recommended.</para>
+
+<para>Scaling or centering a small image still requires an image the
+size of your display to be maintained in memory.</para></tip>
 </listitem>
-</itemizedlist>
+</varlistentry>
+</variablelist>
+</listitem>
+</varlistentry>
 
-<para>You can also check the box labeled <guilabel>Use anti-aliasing for
-fonts</guilabel> if you want smoothed fonts in the login dialog.</para>
+<varlistentry>
+<term><guilabel>Options</guilabel></term>
+<listitem>
 
+<variablelist><!-- Positioning -->
+<title><guilabel>Position:</guilabel></title>
+<varlistentry>
+<term>Centered</term>
+<listitem><para>The image will be centered on the screen without changing the
+size of the image.  The background colors will be present anywhere the image
+does not cover.</para> </listitem>
+</varlistentry>
+<varlistentry>
+<term>Tiled</term>
+<listitem><para>The image will be duplicated until it fills the entire
+desktop. The first image will be placed in the upper left corner of the screen,
+and duplicated downward and to the right.</para></listitem>
+</varlistentry>
+<varlistentry>
+<term>Center Tiled</term>
+<listitem><para>The image will be duplicated until it
+fills the entire desktop. The first image will be placed in the center of the
+screen, and duplicated upward, downward to the right, and to the left.</para>
+</listitem></varlistentry>
+<varlistentry>
+<term>Centered Maxpect</term>
+<listitem><para>The image will be placed in the center of the screen.  It will
+be scaled to fit the desktop, but it will not change the aspect ratio of the
+original image.  This will provide you with an image that is not distorted.
+</para></listitem>
+</varlistentry>
+<varlistentry>
+<term>Tiled Maxpect</term>
+<listitem>
+<para>The image will be placed in the corner of the screen.  It will
+be scaled to fit the desktop, but it will not change the aspect ratio
+of the original image.  This will provide you with an image that is
+not distorted.  If there is any space over, the image will be
+duplicated to fill it.  </para>
+</listitem>
+</varlistentry>
+<varlistentry>
+<term>Scaled</term>
+<listitem><para>The image will be scaled to fit the desktop.  It will be
+stretched to fit to all four corners.  This may distort the image.</para></listitem>
+</varlistentry>
+<varlistentry>
+<term>Centered Auto fit</term>
+<listitem>
+<para>If the picture fits the desktop size, this mode works like the
+centered option. If the picture is larger than the desktop then it is
+scaled down to fit while keeping the aspect ratio.
+</para>
+</listitem>
+</varlistentry>
+<varlistentry>
+<term>Scale &amp; Crop</term>
+<listitem>
+<para>Magnify the picture without distorting it until it fills both the
+width and height of the desktop (cropping the picture if necessary), and
+then center it on the desktop.</para>
+</listitem>
+</varlistentry>
+</variablelist>
+
+<variablelist><!-- Colors -->
+<varlistentry>
+<term><guilabel>Colors:</guilabel></term>
+<listitem>
+<para>The first drop down box allows you to choose the type of color,
+gradient, or pattern to display under (or in place of) wallpaper.</para>
+<tip><para>If you are going to be using a picture as a wallpaper, you
+can skip this section of the dialog box.</para>
+<para>However, if your chosen wallpaper does not cover the entire
+desktop, the chosen colors will still show in the remaining
+space.</para></tip>
+
+<variablelist>
+<varlistentry>
+<term><guilabel>Single Color</guilabel></term>
+<listitem><para>By choosing this mode, you select one color using the
+first color bar, and the entire background is covered with this one
+color.</para></listitem>
+</varlistentry>
+<varlistentry>
+<term><guilabel>Horizontal Gradient</guilabel></term>
+<listitem><para>By choosing this mode, you select two colors (using both color
+buttons).  &kde; will then start with the color selected by <guilabel>Primary
+Color</guilabel> on the left edge of the screen, and slowly transform into the
+color selected by <guilabel>Blend Color</guilabel> by the time it gets to the
+right edge of the screen.</para></listitem>
+</varlistentry>
+<varlistentry>
+<term><guilabel>Vertical Gradient</guilabel></term>
+<listitem><para>By choosing this mode, you select two colors (using both color
+buttons).  &kde; will then start with the color selected by <guilabel>Primary
+Color</guilabel> on the top edge of the screen, and slowly transform into the
+color selected by <guilabel>Blend Color</guilabel> as it moves to the bottom of
+the screen.</para></listitem>
+</varlistentry>
+<varlistentry>
+<term><guilabel>Pyramid Gradient</guilabel></term>
+<listitem><para>By choosing this mode, you select two colors (using both color
+buttons).  &kde; will then start with the color selected by
+<guilabel>Primary Color</guilabel> in each
+corner of the screen, and slowly transform into the color selected by
+<guilabel>Blend Color</guilabel> as it moves to the center of the
+screen.</para></listitem>
+</varlistentry>
+<varlistentry>
+<term><guilabel>Pipecross Gradient</guilabel></term>
+<listitem><para>By choosing this mode, you select two colors (using both color
+buttons).  &kde; will then start with the color selected by
+<guilabel>Primary Color</guilabel> in each corner of the screen, and slowly
+transform into the color selected by <guilabel>Blend Color</guilabel>
+as it moves to the center of the screen. The shape of
+this gradient is different than the pyramid gradient.</para></listitem>
+</varlistentry>
+<varlistentry>
+<term><guilabel>Elliptic Gradient</guilabel></term>
+<listitem><para>By choosing this mode, you select two colors (using both color
+buttons).  &kde; will then start with the color selected by
+<guilabel>Blend Color</guilabel> in the center of the screen, and slowly
+transform into the color selected by <guilabel>Primary Color</guilabel>
+as it moves to the edges, in an elliptical pattern.</para></listitem>
+</varlistentry>
+
+<varlistentry>
+<term><replaceable>Pattern</replaceable></term>
+<listitem>
+<para>The rest of the list are the names of various patterns
+or textures you can choose.</para>
+<para>For more on patterns, see
+the section <link linkend="bkgnd-patterns">Adding, Removing and
+Modifying Patterns</link>.</para>
+
+<para>Select the primary color with the first color bar.  If you have
+chosen a pattern that requires two colors to be set the secondary
+color can be set by pressing the appropriate button.</para>
+</listitem>
+</varlistentry>
+</variablelist>
+
+</listitem>
+</varlistentry>
+</variablelist>
+
+<variablelist>
+<varlistentry>
+<term><guilabel>Blending:</guilabel></term>
+<listitem>
+<para>The drop down box labeled <guilabel>Blending:</guilabel> contains the
+options to make a smooth transition (blend) from the wallpaper as it
+changes to the background.</para>
+
+<orderedlist>
+<listitem><para>A drop down box allows you to select the blending mode.
+Many of the modes are similar to blending modes for background colors.  Select
+your mode from the list, and the preview window shows you what it will look
+like.</para></listitem>
+<listitem><para>The <guilabel>Balance</guilabel> slider adjusts the
+blending.  The results can be seen immediately in the preview
+window.</para></listitem>
+<listitem><para>The <guilabel>Reverse roles</guilabel> can reverse the
+role of the picture and the background for some types of
+blending.</para>
+</listitem>
+</orderedlist>
+</listitem>
+</varlistentry>
+</variablelist>
+</listitem>
+</varlistentry>
+</variablelist>
+
+<sect3 id="bkgnd-advanced">
+<title>Advanced options</title>
+<para>Located below the preview monitor is a button labeled
+<guibutton>Advanced Options</guibutton>.</para>
+
+<para>To use an external program to determine and change the
+background of &kde;, simply select <guilabel>Use the following program
+for drawing the background</guilabel>.  Available &kde; programs are
+listed, select one to enable it.</para>
+
+<!--Not in 4.4
+<para>To add a third party application (&eg;
+<application>XEarth</application>) you may use the
+<guibutton>Add...</guibutton> button.  A dialog will open allowing you
+to choose your application, and fill in other data about it.  You may
+remove any entries from this list by selecting it and pressing the
+<guibutton>Remove</guibutton> button.</para>
+
+<para>Using third party external programs to modify or change the
+background is beyond the scope of this document, see their respective
+documentation for the format of command-line switches and other
+configuration information.</para>
+
+<para>Also in this section you may choose to set the color of text
+that is used for icons on the desktop.  If you find icon text
+difficult to read against a wallpaper or pattern, you can choose a
+solid color to show beneath text, or enable a shadow under the text to
+enhance its appearance.</para>
+
+<para>It is possible to set how many lines of text will be shown beneath each icon with the <guilabel>Lines for icon text:</guilabel>   If the text is longer than can be shown in the configured number of lines, it will be truncated.  You can also set a value for the <guilabel>Width for icon text:</guilabel> option.  The value is in pixels, and the default is <guilabel>Auto</guilabel>, which is a default calculated based on the current font.
+</para>
+
+<para>Finally you can set the <guilabel>Size of the background
+cache:</guilabel>.  The default (2048 KB) is usually a safe
+choice.</para>
+-->
+</sect3>
+
+<sect3 id="bkgnd-patterns">
+<title>Adding, Removing and Modifying Wallpapers and Patterns</title>
+
+<para>There is a button under the preview monitor labelled <guibutton>Get
+New Wallpapers</guibutton> that helps you fetch new wallpaper images from a
+selection of popular images from the <ulink
+url="http://www.kde-look.org">KDE-Look</ulink> website.  You can of course
+select any image you have available to use as wallpaper, and it may be
+stored in any location on your hard drive.  To have a wallpaper show up in
+the list automatically for all users, you should save it to the <filename
+class="directory">$<envar>KDEDIR</envar>/share/wallpapers</filename>
+folder.</para>
+
+<para>A pattern is a picture file which &kde; uses as a template to
+draw your background.  The picture file provides the shapes, but &kde;
+provides the colors.  &kde; is packaged with several patterns, and you also
+can add new patterns.</para>
+
+<para>To add a new pattern that is available to every user on your
+computer, simply place the file in <filename
+class="directory">$<envar>KDEDIR</envar>/share/apps/kdesktop/patterns/</filename>.</para>
+
+<para>Copy a <literal role="extension">.desktop</literal> file from
+this folder, and name it the same as your new pattern image file.
+Modify the contents to suit your new pattern.</para>
+
+<para>To add a new pattern for a single user, add the files to
+<filename
+class="directory">$<envar>KDEHOME</envar>/share/apps/kdesktop/patterns/</filename>.</para>
+
+<para>For best results, the pattern should be a grayscale PNG file.</para>
+
+</sect3>
+
 </sect2>
 
-<sect2 id="kdmconfig-background">
-<title>Background</title>
+<sect2 id="kdmconfig-theme">
+<title>Theme</title>
+<para>This page consists of three sections:</para>
 
-<para>Here you can change the desktop background which will be displayed
-before a user logs in. The options are identical to those described in the
-<ulink url="help:/kcontrol/background/index.html">background settings</ulink>,
-save some that are not applicable to the &kdm; context.</para>
+<para>A list of installed themes, where you can select the one to be used.</para>
 
+<para>A screenshot with a preview of the selected theme and additional 
+information like <guilabel>Copyright</guilabel> and <guilabel>Description</guilabel>.</para>
+
+<para>Three buttons to install or remove a theme and a button to launch
+the <guilabel>Get Hot New Stuff</guilabel> dialog where you can download new themes.</para>
+
+<note><para>The settings on this page are only available in themed mode.</para></note>
+
 </sect2>
 
 <sect2 id="kdmconfig-shutdown">
@@ -533,14 +873,13 @@
 define the exact shutdown command.</para> <para>The
 <guilabel>Halt:</guilabel> command defaults to <!-- Are these defaults still
 correct? they disagree with what's in --> <!-- kdmrc -->
-<command>/sbin/halt</command>.  The <guilabel>Restart:</guilabel> command
+<command>/sbin/halt</command>.  The <guilabel>Reboot:</guilabel> command
 defaults to
 <command>/sbin/reboot</command>.</para>
 
-<para>When <guilabel>Show boot options</guilabel> is enabled, &kdm;
-will on reboot offer you options for the lilo boot manager. For this
-feature to work, you will need to supply the correct paths to your
-<command>lilo</command> command and to lilo's map file.  Note that this
+<para>When <guilabel>Boot manager</guilabel> is set to <guilabel>Grub</guilabel> 
+or <guilabel>Lilo</guilabel>, &kdm;
+will on reboot offer you options for these boot managers. Note that this
 option is not available on all operating systems.</para>
 
 </sect2>
@@ -551,38 +890,45 @@
 <para>From here you can change the way users are represented in the
 login window.</para>
 
+<para>Independently of the users you specify by name, you can use the
+<guilabel>System UIDs</guilabel> to specify a range of valid
+<acronym>UID</acronym>s that are shown in the list.  By default user
+id's under 1000, which are often system or daemon users, and user id's
+over 30000, are not shown.</para>
+
 <para>You may disable the user list in &kdm; entirely in the
-<guilabel>Show Users</guilabel> section.  You can choose from:</para>
+<guilabel>Users</guilabel> section.  You can choose from:</para>
 
 <variablelist>
 <varlistentry>
-<term><guilabel>Show List</guilabel></term>
+<term><guilabel>Show list</guilabel></term>
 <listitem>
-<para>Only show users you have specifically enabled in the list
+<para>Only show users you have specifically not excluded in the list
 alongside</para>
 <para>If you do not check this box, no list will be shown. This is the most secure setting, since an
 attacker would then have to guess a valid login name as well as a
-password. It's also the preferred option if you have more than a
+password. It is also the preferred option if you have more than a
 handful of users to list, or the list itself would become
 unwieldy.</para>
 </listitem>
 </varlistentry>
 <varlistentry>
+<term><guilabel>Autocompletion</guilabel></term>
+<listitem>
+<para>If this option is checked, &kdm; will automatically complete user names while 
+they are typed in the line edit.</para>
+</listitem>
+</varlistentry>
+<varlistentry>
 <term><guilabel>Inverse selection</guilabel></term>
 <listitem>
-<para>Allows you to intead select a list of users that should
-<emphasis>not</emphasis> be shown, and all other users will be
+<para>Allows you to instead select a list of users that should
+be shown, and all other users will <emphasis>not</emphasis> be
 listed.</para>
 </listitem>
 </varlistentry>
 </variablelist>
 
-<para>Independently of the users you specify by name, you can use the
-<guilabel>System UIDs</guilabel> to specify a range of valid
-<acronym>UID</acronym>s that are shown in the list.  By default user
-id's under 1000, which are often system or daemon users, and user id's
-over 65000, are not shown.</para>
-
 <para>You can also enable the <guilabel>Sort users</guilabel>
 checkbox, to have the user list sorted alphabetically.  If this is
 disabled, users will appear in the order they are listed in the
@@ -594,12 +940,16 @@
 to login, they may select their user name/image, enter their password,
 and they are granted access.</para>
 
-<para>If you permit a user image, then you can configure the source
-for those images.</para>
+<para>If you permit a user image, then you can configure the <guilabel>
+User Image Source</guilabel>:</para>
 
-<para>You can configure the admin picture here, for each user on the
-system.  Depending on the order selected above, users may be able to
-override your selection.</para>
+<para>"Here you can specify where &kdm; will obtain the images that represent users. 
+<guilabel>System</guilabel> represents the global folder; these are the pictures you can set 
+below. <guilabel>User</guilabel> means that &kdm; should read the user's 
+<filename>$<envar>HOME</envar>/.face.icon</filename> file. 
+The two selections in the middle define the order of preference if both 
+sources are available.
+</para>
 
 <para>If you choose not to show users, then the login window will be
 more traditional.  Users will need to type their username and password
@@ -611,7 +961,7 @@
 <sect2 id="kdmconfig-convenience">
 <title>Convenience</title>
 
-<para>In the <guilabel>convenience</guilabel> tab you can configure
+<para>In the <guilabel>Convenience</guilabel> tab you can configure
 some options that make life easier for lazy people, like automatic
 login or disabling passwords.</para>
 
@@ -626,15 +976,33 @@
 
 <para>Automatic login will give anyone access to a certain account on
 your system without doing any authentication.  You can enable it using
-the option <guilabel>Enable Auto-login</guilabel>.</para>
+the option <guilabel>Enable Auto-Login</guilabel>.</para>
 
 <para>You can choose the account to be used for automatic login from
 the list labeled <guilabel>User:</guilabel>.</para>
 
-<para>Automatic login can be suppressed by pressing the Shift key immediately
+<para>With <guilabel>Lock session</guilabel> the automatically started session 
+will be locked immediately (provided it is a &kde; session). This can be used 
+to obtain a super-fast login restricted to one user.</para>
+
+<!-- is this true?-->
+<para>Automatic login can be suppressed by pressing the &Shift; key immediately
 after the &X-Server; switches to graphics mode and releasing it when &kdm;'s
 hourglass cursor appears.</para>
+</sect3>
 
+<sect3 id="loginmanager-convenience-preselecteduser">
+<title><guilabel>Preselected User</guilabel></title>
+
+<para>You can also choose which user is <quote>preselected</quote>
+when &kdm; starts. The default is <guilabel>None</guilabel>, but you
+can choose <guilabel>Previous</guilabel> to have &kdm; default to the
+last successfully logged in user, or you can
+<guilabel>Specify</guilabel> a particular user to always be selected
+from the list.  You can also have &kdm; set the focus to the password
+field, so that when you reach the &kdm; login screen, you can type the
+password immediately.</para>
+
 </sect3>
 
 <sect3 id="loginmanager-convenience-nopasswd">
@@ -642,7 +1010,7 @@
 
 <para>Using this feature, you can allow certain users to login without
 having to provide their password. Enable this feature using the
-<guilabel>Enable Password-less logins</guilabel> option.</para>
+<guilabel>Enable Password-Less Logins</guilabel> option.</para>
 
 <para>Below this option you'll see a list of users on the system.
 Enable password-less login for specific users by checking the checkbox
@@ -655,15 +1023,6 @@
 password-less login, &eg;
 <systemitem>guest</systemitem>.</para></important>
 
-<para>You can also choose which user is <quote>preselected</quote>
-when &kdm; starts. The default is <guilabel>None</guilabel>, but you
-can choose <guilabel>Previous</guilabel> to have &kdm; default to the
-last successfully logged in user, or you can
-<guilabel>Specify</guilabel> a particular user to always be selected
-from the list.  You can also have &kdm; set the focus to the password
-field, so that when you reach the &kdm; login screen, you can type the
-password immediately.</para>
-
 <para>The <guilabel>Automatically login after X server crash</guilabel>
 option allows you to skip the authentication procedure when your X
 server accidentally crashed.</para>
@@ -672,8 +1031,6 @@
 
 </sect2>
 
-<!-- XXX Totally outdated stuff ends here. XXX -->
-
 </sect1>
 
 </chapter>
--- workspace/klipper/klipper.cpp	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/klipper/klipper.cpp	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -22,6 +22,8 @@
    Boston, MA 02110-1301, USA.
 */
 
+#include <config-X11.h>
+
 #include <QtDBus/QDBusConnection>
 
 #include <kaboutdata.h>
@@ -53,7 +55,10 @@
 #ifdef Q_WS_X11
 #include <X11/Xlib.h>
 #include <X11/Xatom.h>
+#ifdef HAVE_XFIXES
+#include <X11/extensions/Xfixes.h>
 #endif
+#endif
 
 //#define NOISY_KLIPPER
 #include <KPassivePopup>
@@ -128,6 +133,8 @@
 
     connect( m_clip, SIGNAL(changed(QClipboard::Mode)),
              this, SLOT( newClipData( QClipboard::Mode) ) );
+    connect( &m_empty_detector, SIGNAL(changed(QClipboard::Mode)),
+             this, SLOT( newClipData( QClipboard::Mode) ) );
 
     connect( &m_overflowClearTimer, SIGNAL( timeout()), SLOT( slotClearOverflow()));
 
@@ -1177,4 +1184,58 @@
     return rv;
 }
 
+// http://bugreports.qt.nokia.com/browse/QTBUG-8157
+#if KDE_IS_VERSION( 4, 4, 85 )
+#warning Check if this is still needed, hopefully not.
+#endif
+KlipperEmptyDetector::KlipperEmptyDetector()
+: m_xfixes_event_base( -1 )
+, m_xa_clipboard( None )
+{
+#ifdef HAVE_XFIXES
+    m_xa_clipboard = XInternAtom( QX11Info::display(), "CLIPBOARD", False );
+    kapp->installX11EventFilter( this );
+    int dummy;
+    if( XFixesQueryExtension( QX11Info::display(), &m_xfixes_event_base, &dummy ))
+    {
+        XFixesSelectSelectionInput( QX11Info::display(), QX11Info::appRootWindow( 0 ), XA_PRIMARY,
+            XFixesSetSelectionOwnerNotifyMask |
+            XFixesSelectionWindowDestroyNotifyMask |
+            XFixesSelectionClientCloseNotifyMask );
+        XFixesSelectSelectionInput( QX11Info::display(), QX11Info::appRootWindow( 0 ), m_xa_clipboard,
+            XFixesSetSelectionOwnerNotifyMask |
+            XFixesSelectionWindowDestroyNotifyMask |
+            XFixesSelectionClientCloseNotifyMask );
+    }
+#endif
+}
+
+bool KlipperEmptyDetector::x11Event( XEvent* e )
+{
+#ifdef HAVE_XFIXES
+    if( m_xfixes_event_base != -1 && e->type == m_xfixes_event_base + XFixesSelectionNotify )
+    {
+        XFixesSelectionNotifyEvent* ev = reinterpret_cast< XFixesSelectionNotifyEvent* >( e );
+        if( ev->subtype == XFixesSelectionWindowDestroyNotify || ev->subtype == XFixesSelectionClientCloseNotify )
+        {
+            if( ev->selection == XA_PRIMARY && !kapp->clipboard()->ownsSelection())
+            {
+#ifdef NOISY_KLIPPER
+                kDebug() << "Selection lost";
+#endif
+                emit changed( QClipboard::Selection );
+            }
+            else if( ev->selection == m_xa_clipboard && !kapp->clipboard()->ownsClipboard())
+            {
+#ifdef NOISY_KLIPPER
+                kDebug() << "Clipboard lost";
+#endif
+                emit changed( QClipboard::Clipboard );
+            }
+        }
+    }
+#endif
+    return false;
+}
+
 #include "klipper.moc"
--- workspace/klipper/klipper.h	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/klipper/klipper.h	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -45,6 +45,20 @@
 class HistoryItem;
 class KlipperSessionManager;
 
+class KlipperEmptyDetector : public QWidget
+{
+Q_OBJECT
+public:
+    KlipperEmptyDetector();
+signals:
+    void changed( QClipboard::Mode m );
+protected:
+    virtual bool x11Event( XEvent* e );
+private:
+    int m_xfixes_event_base;
+    unsigned int m_xa_clipboard;
+};
+
 class Klipper : public QObject
 {
   Q_OBJECT
@@ -220,6 +234,7 @@
     QString cycleText() const;
     KlipperSessionManager* m_session_managed;
     KActionCollection *m_collection;
+    KlipperEmptyDetector m_empty_detector;
 };
 
 #endif
--- workspace/wallpapers/Quadros/metadata.desktop	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/wallpapers/Quadros/metadata.desktop	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -12,6 +12,7 @@
 Name[fr]=Quadros
 Name[fy]=Quadros
 Name[hr]=Quadros
+Name[hu]=Quadros
 Name[id]=Quadros
 Name[it]=Quadri
 Name[kk]=
--- workspace/wallpapers/Media_Life/metadata.desktop	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/wallpapers/Media_Life/metadata.desktop	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -11,6 +11,7 @@
 Name[fr]=Vie des mdia
 Name[fy]=Media Life
 Name[hr]=Trajanje medija
+Name[hu]=Mdia
 Name[id]=Hidup Media
 Name[it]=Vita nei media
 Name[kk]= 
--- workspace/krunner/interfaces/quicksand/qs_matchview.cpp	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/krunner/interfaces/quicksand/qs_matchview.cpp	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -206,6 +206,7 @@
         d->m_items << items;
     }
     qStableSort(d->m_items.begin(), d->m_items.end(), queryMatchCompare);
+    d->m_compBox->clear();
 
     foreach(MatchItem *item, d->m_items) {
         if (item) {
--- workspace/krunner/interfaces/default/interface.cpp	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/krunner/interfaces/default/interface.cpp	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -258,7 +258,7 @@
 }
 void Interface::setConfigWidget(QWidget *w)
 {
-    m_resultsView->hide();
+    m_resultsContainer->hide();
     m_searchTerm->setEnabled(false);
     m_layout->addWidget(w);
     resize(m_defaultSize);
@@ -272,9 +272,8 @@
 
 void Interface::cleanupAfterConfigWidget()
 {
-    m_resultsView->show();
-    resize(qMax(minimumSizeHint().width(), m_defaultSize.width()), minimumSizeHint().height());
     m_searchTerm->setEnabled(true);
+    resetInterface();
     m_searchTerm->setFocus();
 }
 
@@ -584,7 +583,7 @@
         return;
     }
 
-    if (m_resultsView->isVisible() == show) {
+    if (m_resultsContainer->isVisible() == show) {
         return;
     }
 
--- workspace/krunner/lock/lockdlg.cc	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/krunner/lock/lockdlg.cc	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -85,7 +85,8 @@
     : KDialog(parent, Qt::X11BypassWindowManagerHint),
       mPlugin( plugin ),
       mCapsLocked(-1),
-      mUnlockingFailed(false)
+      mUnlockingFailed(false),
+      sNot(0)
 {
     QWidget* w = mainWidget();
 
@@ -317,9 +318,14 @@
 {
     sNot->setEnabled( false );
     sNot->deleteLater();
+    sNot = 0;
     ::close( sFd );
     int status;
-    ::waitpid( sPid, &status, 0 );
+    while (::waitpid( sPid, &status, 0 ) < 0)
+        if (errno != EINTR) { // This should not happen ...
+            cantCheck();
+            return;
+        }
     if (WIFEXITED(status))
         switch (WEXITSTATUS(status)) {
         case AuthOk:
@@ -434,6 +440,8 @@
     int sfd[2];
     char fdbuf[16];
 
+    if (sNot)
+        return;
     if (::socketpair(AF_LOCAL, SOCK_STREAM, 0, sfd)) {
         cantCheck();
         return;
--- workspace/libs/plasmagenericshell/widgetsexplorer/applettooltip.cpp	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/libs/plasmagenericshell/widgetsexplorer/applettooltip.cpp	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -218,6 +218,10 @@
 
 void AppletInfoWidget::uninstall()
 {
+    if (!m_appletItem) {
+        return;
+    }
+
     Plasma::PackageStructure installer;
     installer.uninstallPackage(m_appletItem->pluginName(),
                                KStandardDirs::locateLocal("data", "plasma/plasmoids/"));
--- workspace/libs/ksysguard/processui/scripting.cpp	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/libs/ksysguard/processui/scripting.cpp	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -70,16 +70,13 @@
 QScriptValue setHtml(QScriptContext *context, QScriptEngine *engine)
 {
     Scripting *scriptingParent = static_cast<Scripting *>(qVariantValue<QObject*>(engine->property("scriptingParent")));
-
     if(context->argumentCount() != 1) {
-        KMessageBox::sorry(scriptingParent, i18np("Script error: There needs to be exactly one argument to setHtml(), but there was %1.",
-                                                  "Script error: There needs to be exactly one argument to setHtml(), but there were %1.",
-                                                  context->argumentCount()));
-        return QScriptValue();
+        return context->throwError(QScriptContext::SyntaxError, i18np("Script error: There needs to be exactly one argument to setHtml(), but there was %1.",
+                    "Script error: There needs to be exactly one argument to setHtml(), but there were %1.",
+                    context->argumentCount()));
     }
     if(!context->argument(0).isString()) {
-        KMessageBox::sorry(scriptingParent, i18n("Script error: Argument to setHtml() was not a string"));
-        return QScriptValue();
+        return context->throwError(QScriptContext::TypeError, i18n("Script error: Argument to setHtml() was not a string"));
     }
     QString html = context->argument(0).toString();
 
@@ -105,20 +102,17 @@
 
 QScriptValue fileExists(QScriptContext *context, QScriptEngine *engine)
 {
-    Scripting *scriptingParent = static_cast<Scripting *>(qVariantValue<QObject*>(engine->property("scriptingParent")));
+    Q_UNUSED(engine);
     /* We do lots of checks on the file to see whether we should allow this to be read
      * Maybe this is a bit too paranoid and too restrictive.  Some restrictions
      * may be lifted */
-    if(context->argumentCount() !=1) {
-        KMessageBox::sorry(scriptingParent, i18np("Script error: There needs to be exactly one argument to fileExists(), but there was %1.",
-                                                  "Script error: There needs to be exactly one argument to fileExists(), but there were %1.",
-                                                  context->argumentCount()));
-        return QScriptValue(engine, false);
+    if(context->argumentCount() !=1)  {
+        return context->throwError(QScriptContext::SyntaxError, i18np("Script error: There needs to be exactly one argument to fileExists(), but there was %1.",
+                    "Script error: There needs to be exactly one argument to fileExists(), but there were %1.",
+                    context->argumentCount()));
     }
-    if(!context->argument(0).isString()) {
-        KMessageBox::sorry(scriptingParent, i18n("Script error: Argument to fileExists() was not a string"));
-        return QScriptValue(engine, false);
-    }
+    if(!context->argument(0).isString())
+        return context->throwError(QScriptContext::TypeError, i18n("Script error: Argument to fileExists() was not a string"));
     QString filename = context->argument(0).toString();
     QFileInfo fileInfo(filename);
     return QScriptValue(engine, fileInfo.exists());
@@ -126,20 +120,16 @@
 }
 QScriptValue readFile(QScriptContext *context, QScriptEngine *engine)
 {
-    Scripting *scriptingParent = static_cast<Scripting *>(qVariantValue<QObject*>(engine->property("scriptingParent")));
+    Q_UNUSED(engine);
     /* We do lots of checks on the file to see whether we should allow this to be read
      * Maybe this is a bit too paranoid and too restrictive.  Some restrictions
      * may be lifted */
-    if(context->argumentCount() !=1) {
-        KMessageBox::sorry(scriptingParent, i18np("Script error: There needs to be exactly one argument to readFile(), but there was %1.",
-                                                  "Script error: There needs to be exactly one argument to readFile(), but there were %1.",
-                                                  context->argumentCount()));
-        return QScriptValue();
-    }
-    if(!context->argument(0).isString()) {
-        KMessageBox::sorry(scriptingParent, i18n("Script error: Argument to readFile() was not a string"));
-        return QScriptValue();
-    }
+    if(context->argumentCount() !=1)
+        return context->throwError(QScriptContext::SyntaxError, i18np("Script error: There needs to be exactly one argument to readFile(), but there was %1.",
+                    "Script error: There needs to be exactly one argument to readFile(), but there were %1.",
+                    context->argumentCount()));
+    if(!context->argument(0).isString())
+        return context->throwError(QScriptContext::TypeError, i18n("Script error: Argument to readFile() was not a string"));
     QString filename = context->argument(0).toString();
     QFile file(filename);
     if(!file.open(QIODevice::ReadOnly)) {
--- workspace/khotkeys/kcm_hotkeys/settings-input-actions.desktop	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/khotkeys/kcm_hotkeys/settings-input-actions.desktop	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -35,7 +35,7 @@
 Name[he]= 
 Name[hi]= 
 Name[hne]= 
-Name[hr]=Aktivnosti unosa
+Name[hr]=Akcije preaca
 Name[hsb]=Zapodawanske akcije
 Name[hu]=Beviteli mveletek
 Name[id]=Aksi Masukan
--- workspace/khotkeys/kcm_hotkeys/khotkeys.desktop	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/khotkeys/kcm_hotkeys/khotkeys.desktop	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -39,7 +39,7 @@
 Name[he]= 
 Name[hi]= 
 Name[hne]= 
-Name[hr]=Aktivnosti unosa
+Name[hr]=Akcije preaca
 Name[hsb]=Zapodawanske akcije
 Name[hu]=Beviteli mveletek
 Name[id]=Aksi Masukan
--- workspace/ksplash/ksplashx/README	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/ksplash/ksplashx/README	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -19,6 +19,7 @@
 NOTES:
 Add a comment in description.txt and update it everytime you change anything.
 Caching of the splash is done and the timestamp of description.txt is used.
+Alternatively, update at least Theme.rc.
 
 New images are alphablended (if needed) with what's in the splash window
 and then they replace what's at their position. Animations have all frames
--- workspace/ksplash/ksplashx/splash.cpp	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/ksplash/ksplashx/splash.cpp	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -839,6 +839,12 @@
         exit( 2 );
         }
     timestamp = stat_buf.st_mtime;
+    // check also Theme.rc, as artists are likely to just ignore updating description.txt
+    // when updating the theme but will touch info in Theme.rc
+    char tmp[ 1024 ];
+    snprintf( tmp, 1024, "%s/Theme.rc", theme_dir );
+    if( stat( tmp, &stat_buf ) == 0 && stat_buf.st_mtime > timestamp )
+	timestamp = stat_buf.st_mtime;
     double ratiox = double( desc_w ) / screenGeometry(0).width(); // only for coordinates in the description file
     double ratioy = double( desc_h ) / screenGeometry(0).height(); // only for coordinates in the description file
     XSelectInput( qt_xdisplay(), DefaultRootWindow( qt_xdisplay()), SubstructureNotifyMask );
--- workspace/kwin/clients/aurorae/src/aurorae.desktop	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/kwin/clients/aurorae/src/aurorae.desktop	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -4,7 +4,7 @@
 Name[ca@valencia]=Motor del tema de decoraci Aurorae
 Name[csb]=Mtr dekracji wzdrzatk Aurorae
 Name[da]=Temamotor til Aurorae-dekorationen
-Name[de]=Aurorae-Design-Treiber
+Name[de]=Aurorae
 Name[el]=   Aurorae
 Name[en_GB]=Auror Decoration Theme Engine
 Name[eo]=Aurorae Ornama-etosa Modulo
--- workspace/kwin/clients/oxygen/oxygenclientgroupitemdata.cpp	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/kwin/clients/oxygen/oxygenclientgroupitemdata.cpp	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -39,6 +39,8 @@
     QObject( parent ),
     QList<ClientGroupItemData>(),
     client_( *parent ),
+    dirty_( false ),
+    animationsEnabled_( true ),
     animation_( new Animation( 150, this ) ),
     animationType_( AnimationNone ),
     progress_(0),
@@ -157,9 +159,20 @@
         targetRect_.setWidth( width );
       }
 
-      if( animate ) animation().data()->start();
-      else {
+      if( animate )
+      {
 
+        if( animationsEnabled() ) animation().data()->start();
+        else {
+
+          // change progress to maximum
+          progress_ = 1;
+          updateBoundingRects();
+
+        }
+
+      } else {
+
         for( int index = 0; index < count(); index++ )
         {
           ClientGroupItemData& item( ClientGroupItemDataList::operator[](index) );
@@ -236,7 +249,14 @@
 
       }
 
-      animation().data()->start();
+      if( animationsEnabled() ) animation().data()->start();
+      else {
+        
+        // change progress to maximum
+        progress_ = 1;
+        updateBoundingRects();
+        
+      }
 
     }
 
--- workspace/kwin/clients/oxygen/oxygenconfiguration.cpp	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/kwin/clients/oxygen/oxygenconfiguration.cpp	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -42,7 +42,7 @@
     hideTitleBar_( false ),
     useOxygenShadows_( true ),
     useAnimations_( true ),
-    animateTitleChange_( false ),
+    animateTitleChange_( true ),
     animationsDuration_( 150 ),
     tabsEnabled_( true ),
     useNarrowButtonSpacing_( false )
--- workspace/kwin/clients/oxygen/oxygenclientgroupitemdata.h	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/kwin/clients/oxygen/oxygenclientgroupitemdata.h	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -121,6 +121,14 @@
     bool isDirty( void ) const
     { return dirty_; }
 
+    //! enable animations
+    void setAnimationsEnabled( bool value )
+    { animationsEnabled_ = value; }
+
+    //! animations enabled
+    bool animationsEnabled( void ) const
+    { return animationsEnabled_; }
+
     //! true if being animated
     bool isAnimated( void ) const
     { return animationType_ != AnimationNone; }
@@ -183,6 +191,9 @@
     /* used to trigger update at next paintEvent */
     bool dirty_;
 
+    //! true if animations are enabled
+    bool animationsEnabled_;
+
     //! animation
     Animation::Pointer animation_;
 
--- workspace/kwin/clients/oxygen/oxygentitleanimationdata.cpp	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/kwin/clients/oxygen/oxygentitleanimationdata.cpp	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -33,6 +33,9 @@
 namespace Oxygen
 {
 
+    // use 300 milliseconds for animation lock
+    const int TitleAnimationData::lockTime_ = 300;
+
     //_________________________________________________________
     TitleAnimationData::TitleAnimationData( QObject* parent ):
         QObject( parent ),
@@ -82,6 +85,25 @@
     }
 
     //_________________________________________________________
+    void TitleAnimationData::timerEvent( QTimerEvent* e )
+    {
+
+        if( e->timerId() != animationLockTimer_.timerId() )
+        { return QObject::timerEvent( e ); }
+
+        // stop veto
+        animationLockTimer_.stop();
+
+        if( !isAnimated() )
+        {
+            // triggers pixmap updates
+            reset();
+            emit pixmapsChanged();
+        }
+
+    }
+
+    //_________________________________________________________
     void TitleAnimationData::BlendedPixmap::blend( qreal opacity )
     {
 
--- workspace/kwin/clients/oxygen/oxygenclient.cpp	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/kwin/clients/oxygen/oxygenclient.cpp	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -174,6 +174,7 @@
     glowAnimation().data()->setDuration( configuration_.animationsDuration() );
     titleAnimationData_.data()->setDuration( configuration_.animationsDuration() );
     itemData_.animation().data()->setDuration( configuration_.animationsDuration() );
+    itemData_.setAnimationsEnabled( configuration_.useAnimations() );
 
     // reset title transitions
     titleAnimationData_.data()->reset();
@@ -419,14 +420,6 @@
   QRect OxygenClient::titleBoundingRect( const QFont& font, QRect rect, const QString& caption ) const
   {
 
-    // check bounding rect against titleRect
-    if( titleRectCanConflict() ) 
-    {
-      QRect titleRect( OxygenClient::titleRect() );
-      if( titleRect.left() > rect.left() ) { rect.setLeft( titleRect.left() ); }
-      if( titleRect.right() < rect.right() ) { rect.setRight( titleRect.right() ); }
-    }
-
     // get title bounding rect
     QRect boundingRect = QFontMetrics( font ).boundingRect( rect, configuration().titleAlignment() | Qt::AlignVCenter, caption );
 
@@ -819,16 +812,36 @@
     if( titleAnimationData_.data()->isDirty() )
     {
 
-        // contrast pixmap
-        titleAnimationData_.data()->setPixmaps(
-            rect,
-            renderTitleText( rect, caption(), color ),
-            renderTitleText( rect, caption(), contrast ) );
-
+        // clear dirty flags
         titleAnimationData_.data()->setDirty( false );
-        titleAnimationData_.data()->startAnimation();
-        renderTitleText( painter, rect, color, contrast );
 
+        // finish current animation if running
+        if( titleAnimationData_.data()->isAnimated() )
+        { titleAnimationData_.data()->finishAnimation(); }
+
+        if( !titleAnimationData_.data()->isLocked() )
+        {
+
+            // set pixmaps
+            titleAnimationData_.data()->setPixmaps(
+                rect,
+                renderTitleText( rect, caption(), color ),
+                renderTitleText( rect, caption(), contrast ) );
+
+            titleAnimationData_.data()->startAnimation();
+            renderTitleText( painter, rect, color, contrast );
+
+        } else if( !caption().isEmpty() ) {
+
+            renderTitleText( painter, rect, caption(), color, contrast );
+
+        }
+
+        // lock animations (this must be done whether or not
+        // animation was actually started, in order to extend locking
+        // every time title get changed too rapidly
+        titleAnimationData_.data()->lockAnimations();
+
     } else if( titleAnimationData_.data()->isAnimated() ) {
 
         if( isMaximized() ) painter->translate( 0, 2 );
@@ -927,20 +940,25 @@
     const QList< ClientGroupItem >& items( clientGroupItems() );
     QString caption( itemCount == 1 ? OxygenClient::caption() : items[index].title() );
 
-    // make sure title rect never conflicts with decoration buttons
-    if( titleRectCanConflict() ) 
-    { textRect = titleBoundingRect( painter->font(), textRect, caption ); }
-    
+    // always make sure that titleRect never conflicts with window buttons
+    QRect titleRect( OxygenClient::titleRect() );
+    if( titleRect.left() > textRect.left() ) { textRect.setLeft( titleRect.left() ); }
+    if( titleRect.right() < textRect.right() ) { textRect.setRight( titleRect.right() ); }
+
     // title outline
     if( itemCount == 1 )
     {
-        
+
       if( itemData_.isAnimated() ) {
 
+        textRect = titleBoundingRect( painter->font(), textRect, caption );
         renderTitleOutline( painter, item.boundingRect_, palette );
 
       } else if( (isActive()||glowIsAnimated()) && configuration().drawTitleOutline() ) {
 
+        // adjust textRect
+        textRect = titleBoundingRect( painter->font(), textRect, caption );
+
         // adjusts boundingRect accordingly
         QRect boundingRect( item.boundingRect_ );
         boundingRect.setLeft( textRect.left() - layoutMetric( LM_TitleBorderLeft ) );
--- workspace/kwin/clients/oxygen/oxygentitleanimationdata.h	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/kwin/clients/oxygen/oxygentitleanimationdata.h	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -33,8 +33,11 @@
 #include <cassert>
 #include <QtCore/QObject>
 #include <QtCore/QWeakPointer>
+#include <QtCore/QBasicTimer>
+#include <QtCore/QTimerEvent>
 #include <QtGui/QPixmap>
 
+
 namespace Oxygen
 {
 
@@ -94,16 +97,32 @@
         //@{
 
 
+        //! returns true if animations are locked
+        bool isLocked( void ) const
+        { return animationLockTimer_.isActive(); }
+
+        //! returns true if title transition animation is currently running
         bool isAnimated( void ) const
         { return animation().data()->isRunning(); }
 
-        //! start animation
+        //! start lock animation timer
+        void lockAnimations( void )
+        { animationLockTimer_.start( lockTime_, this ); }
+
+        //! start title transition animation
         void startAnimation( void )
         {
             assert( !isAnimated() );
             animation().data()->start();
         }
 
+        //! finish title transition animation
+        void finishAnimation( void )
+        {
+            assert( isAnimated() );
+            animation().data()->stop();
+        }
+
         //@}
 
         //!@name opacity
@@ -140,6 +159,9 @@
 
         protected:
 
+        //! timer event
+        void timerEvent( QTimerEvent* );
+
         //! animation object
         const Animation::Pointer& animation( void ) const
         { return animation_; }
@@ -212,6 +234,12 @@
         BlendedPixmap contrastPixmap_;
         BlendedPixmap pixmap_;
 
+        //! lock time (milliseconds
+        static const int lockTime_;
+
+        //! timer used to disable animations when triggered too early
+        QBasicTimer animationLockTimer_;
+
         //! title animation
         Animation::Pointer animation_;
 
--- workspace/kwin/clients/oxygen/oxygenclient.h	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/kwin/clients/oxygen/oxygenclient.h	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -302,15 +302,6 @@
                 !isPreview();
         }
 
-        //! returns true if drawn item can conflict with buttons.
-        /*! 
-        this might happen either
-        - when there is only one item in the group
-        - when there are two items but the second is being dragged in or away
-        */
-        bool titleRectCanConflict( void ) const
-        {  return ( itemData_.count() == 1 || ( itemData_.count() == 2 && (itemData_.animationType()&AnimationSameTarget) ) ); }
-        
         //! calculate mask
         QRegion calcMask( void ) const;
 
--- workspace/kwin/kcmkwin/kwindecoration/kwindecoration.desktop	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/kwin/kcmkwin/kwindecoration/kwindecoration.desktop	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -89,7 +89,7 @@
 Name[wa]=Purneas
 Name[x-test]=xxWindowsxx
 Name[zh_CN]=
-Name[zh_TW]=Windows
+Name[zh_TW]=
 
 Comment=Configure the look and feel of window titles
 Comment[af]=Stel die lyk-en-gevoel van venstertitels
--- workspace/plasma/netbook/containments/sal/itemcontainer.cpp	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/netbook/containments/sal/itemcontainer.cpp	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -37,7 +37,7 @@
       m_currentIconIndexX(-1),
       m_currentIconIndexY(-1),
       m_iconSize(KIconLoader::SizeHuge),
-      m_maxColumnWidth(0),
+      m_maxColumnWidth(1),
       m_maxRowHeight(1),
       m_firstRelayout(true)
 {
@@ -110,12 +110,6 @@
     icon->setMaximumSize(icon->sizeFromIconSize(m_iconSize));
     icon->setSizePolicy(QSizePolicy::Fixed, QSizePolicy::Fixed);
 
-    if (icon->size().width() > m_maxColumnWidth) {
-        m_maxColumnWidth = icon->size().width();
-    }
-    if (icon->size().height() > m_maxRowHeight) {
-        m_maxRowHeight = icon->size().height();
-    }
     icon->hide();
 
     if (weight != -1 || m_items.count() == 0) {
@@ -131,7 +125,6 @@
 
 void ItemContainer::clear()
 {
-    m_maxColumnWidth = 1;
     m_hoverIndicator->setTargetItem(0);
     for (int i = 0; i < m_layout->count(); ++i) {
         m_layout->removeAt(0);
@@ -255,6 +248,18 @@
 
     setMaximumSize(QWIDGETSIZE_MAX, QWIDGETSIZE_MAX);
 
+    //FIXME: here is inefficient but we ore sure only there abut what items are in
+    int maxColumnWidth = 0;
+    int maxRowHeight = 0;
+    foreach (Plasma::IconWidget *icon, m_items) {
+        if (icon->size().width() > maxColumnWidth) {
+            maxColumnWidth = icon->size().width();
+        }
+        if (icon->size().height() > maxRowHeight) {
+            maxRowHeight = icon->size().height();
+        }
+    }
+
     if (m_orientation == Qt::Vertical) {
 
         int nColumns;
@@ -262,7 +267,7 @@
         if (validColumn > 0 && m_layout->columnCount() > 0 &&  m_layout->rowCount() > 0) {
             nColumns = m_layout->columnCount();
         } else {
-            nColumns = qMax(1, int(availableSize.width() / m_maxColumnWidth));
+            nColumns = qMax(1, int(availableSize.width() / maxColumnWidth));
         }
         int i = 0;
 
@@ -293,11 +298,10 @@
         if (validRow > 0 && m_layout->columnCount() > 0 &&  m_layout->rowCount() > 0) {
             nRows = m_layout->rowCount();
         } else {
-            nRows = qMax(1, int(availableSize.height() / m_maxRowHeight));
+            nRows = qMax(1, int(availableSize.height() / maxRowHeight));
         }
         int i = 0;
 
-
         Plasma::IconWidget *lastIcon = 0;
         foreach (Plasma::IconWidget *icon, m_items) {
             if (lastIcon && icon->size().height() < lastIcon->size().height()/2) {
@@ -339,7 +343,7 @@
     while (i.hasNext()) {
         i.next();
         if (i.value() == icon) {
-            m_items.remove(i.key());
+            m_items.remove(i.key(), i.value());
             break;
         }
     }
--- workspace/plasma/netbook/containments/sal/sal.cpp	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/netbook/containments/sal/sal.cpp	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -113,7 +113,7 @@
     connect(m_toolBox, SIGNAL(visibilityChanged(bool)), this, SIGNAL(toolBoxVisibilityChanged(bool)));
     m_toolBox->show();
 
-    m_orientation = (Qt::Orientation)config().readEntry("orientation", (int)Qt::Vertical);
+    configChanged();
 
     QAction *a = action("add widgets");
     if (a) {
@@ -166,6 +166,11 @@
     addAction("previous containment", a);
 }
 
+void SearchLaunch::configChanged()
+{
+    m_orientation = (Qt::Orientation)config().readEntry("orientation", (int)Qt::Vertical);
+}
+
 void SearchLaunch::toggleImmutability()
 {
     if (immutability() == Plasma::UserImmutable) {
--- workspace/plasma/netbook/containments/sal/sal.h	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/netbook/containments/sal/sal.h	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -68,6 +68,7 @@
     void doSearch(const QString &query, const QString &runner = QString());
 
 public Q_SLOTS:
+    void configChanged();
     void dataUpdated(const QString &sourceName, const Plasma::DataEngine::Data &data);
 
 private Q_SLOTS:
--- workspace/plasma/netbook/containments/sal/itemview.cpp	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/netbook/containments/sal/itemview.cpp	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -30,6 +30,7 @@
     : Plasma::ScrollWidget(parent)
 {
     setFocusPolicy(Qt::StrongFocus);
+    setSizePolicy(QSizePolicy::Expanding, QSizePolicy::Expanding);
     m_itemContainer = new ItemContainer(this);
     setWidget(m_itemContainer);
     m_noActivateTimer = new QTimer(this);
@@ -152,11 +153,6 @@
             scrollBars |= VerticalScrollBar;
         }
         emit scrollBarsNeededChanged(scrollBars);
-
-        //FIXME: this is not desired probably?
-        if (orientation() == Qt::Horizontal) {
-            setMinimumHeight(re->newSize().height() + (size().height()-contentsRect().height()+6));
-        }
     } else if (watched == m_itemContainer && event->type() == QEvent::GraphicsSceneMove) {
         m_noActivateTimer->start(300);
         ScrollBarFlags scrollBars = NoScrollBar;
--- workspace/plasma/desktop/applets/kickoff/core/systemmodel.cpp	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/desktop/applets/kickoff/core/systemmodel.cpp	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -52,21 +52,22 @@
 
 struct UsageInfo {
     UsageInfo()
-            : used(0),
-            available(0),
-            dirty(true) {}
+        : used(0),
+          available(0)
+     {}
 
     quint64 used;
     quint64 available;
-    bool dirty;
 };
 
 class SystemModel::Private
 {
 public:
     Private(SystemModel *parent)
-            : q(parent)
-            , placesModel(new KFilePlacesModel(parent)) {
+            : q(parent),
+              placesModel(new KFilePlacesModel(parent)),
+              currentPlacesModelUsageIndex(0)
+    {
         q->setSourceModel(placesModel);
 
         connect(placesModel, SIGNAL(dataChanged(QModelIndex, QModelIndex)),
@@ -84,44 +85,15 @@
         << i18n("Places")
         << i18n("Removable Storage")
         << i18n("Storage");
-        loadApplications();
-        connect(&refreshTimer, SIGNAL(timeout()),
-                q, SLOT(startRefreshingUsageInfo()));
-        refreshTimer.start(10000);
-        QTimer::singleShot(0, q, SLOT(startRefreshingUsageInfo()));
         connect(KSycoca::self(), SIGNAL(databaseChanged(const QStringList&)), q, SLOT(reloadApplications()));
     }
 
-    void queryFreeSpace(const QString& mountPoint) {
-        KDiskFreeSpaceInfo freeSpace = KDiskFreeSpaceInfo::freeSpaceInfo(mountPoint);
-        if (freeSpace.isValid())
-            q->freeSpaceInfoAvailable(freeSpace.mountPoint(), freeSpace.size() / 1024,
-                                      freeSpace.used() / 1024, freeSpace.available() / 1024);
-    }
-
-    void loadApplications() {
-        const QStringList apps = Kickoff::systemApplicationList();
-        appsList.clear();
-
-        foreach(const QString &app, apps) {
-            KService::Ptr service = KService::serviceByStorageId(app);
-
-            if (!service) {
-                continue;
-            }
-
-            appsList << service;
-        }
-        //kDebug() << "*************" << appsList;
-    }
-
     SystemModel * const q;
     KFilePlacesModel *placesModel;
     QStringList topLevelSections;
     KService::List appsList;
-    QList<QString> mountPointsQueue;
     QMap<QString, UsageInfo> usageByMountpoint;
-    QTimer refreshTimer;
+    int currentPlacesModelUsageIndex;
 };
 
 SystemModel::SystemModel(QObject *parent)
@@ -137,7 +109,9 @@
 
 QModelIndex SystemModel::mapFromSource(const QModelIndex &sourceIndex) const
 {
-    if (!sourceIndex.isValid()) return QModelIndex();
+    if (!sourceIndex.isValid()) {
+        return QModelIndex();
+    }
 
     QModelIndex parent;
 
@@ -356,75 +330,60 @@
     }
 }
 
-void SystemModel::startRefreshingUsageInfo()
+void SystemModel::refreshUsageInfo()
 {
-    if (!d->mountPointsQueue.isEmpty()) {
-        return;
-    }
-
-    int rowCount = d->placesModel->rowCount();
-    for (int i = 0; i < rowCount; ++i) {
-        QModelIndex index = d->placesModel->index(i, 0);
-        if (d->placesModel->isDevice(index)) {
-            Solid::Device dev = d->placesModel->deviceForIndex(index);
-            Solid::StorageAccess *access = dev.as<Solid::StorageAccess>();
-
-            if (access && !access->filePath().isEmpty()) {
-                d->mountPointsQueue << access->filePath();
-            }
-        }
-    }
-
-    if (!d->mountPointsQueue.isEmpty()) {
-        d->queryFreeSpace(d->mountPointsQueue.takeFirst());
-    }
+    d->currentPlacesModelUsageIndex = 0;
+    QTimer::singleShot(100, this, SLOT(refreshNextUsageInfo()));
 }
 
-void SystemModel::reloadApplications()
+void SystemModel::stopRefreshingUsageInfo()
 {
-    d->loadApplications();
+    d->currentPlacesModelUsageIndex = d->placesModel->rowCount();
 }
 
-void SystemModel::freeSpaceInfoAvailable(const QString& mountPoint, quint64,
-        quint64 kbUsed, quint64 kbAvailable)
+void SystemModel::refreshNextUsageInfo()
 {
-    UsageInfo info;
-    info.used = kbUsed;
-    info.available = kbAvailable;
-
-    d->usageByMountpoint[mountPoint] = info;
-
-    // More to process
-    if (!d->mountPointsQueue.isEmpty()) {
-        d->queryFreeSpace(d->mountPointsQueue.takeFirst());
+    if (d->currentPlacesModelUsageIndex >= d->placesModel->rowCount()) {
         return;
     }
 
-    // We're done, let's emit the changes
-    int rowCount = d->placesModel->rowCount();
-    for (int i = 0; i < rowCount; ++i) {
-        QModelIndex sourceIndex = d->placesModel->index(i, 0);
-        if (d->placesModel->isDevice(sourceIndex)) {
-            Solid::Device dev = d->placesModel->deviceForIndex(sourceIndex);
-            Solid::StorageAccess *access = dev.as<Solid::StorageAccess>();
+    QModelIndex sourceIndex = d->placesModel->index(d->currentPlacesModelUsageIndex, 0);
+    if (d->placesModel->isDevice(sourceIndex)) {
+        Solid::Device dev = d->placesModel->deviceForIndex(sourceIndex);
+        Solid::StorageAccess *access = dev.as<Solid::StorageAccess>();
 
-            if (access && d->usageByMountpoint.contains(access->filePath())) {
-                info = d->usageByMountpoint[access->filePath()];
+        if (access && !access->filePath().isEmpty()) {
+            KDiskFreeSpaceInfo freeSpace = KDiskFreeSpaceInfo::freeSpaceInfo(access->filePath());
+            if (freeSpace.isValid()) {
+                UsageInfo info;
+                info.used = freeSpace.used() / 1024;
+                info.available = freeSpace.available() / 1024;
 
-                if (info.dirty) {
-                    info.dirty = false;
-                    d->usageByMountpoint[access->filePath()] = info;
-                } else {
-                    d->usageByMountpoint.remove(access->filePath());
-                }
-
+                d->usageByMountpoint[freeSpace.mountPoint()] = info;
                 QModelIndex index = mapFromSource(sourceIndex);
                 emit dataChanged(index, index);
             }
         }
     }
+
+    ++d->currentPlacesModelUsageIndex;
+    QTimer::singleShot(0, this, SLOT(refreshNextUsageInfo()));
 }
 
+void SystemModel::reloadApplications()
+{
+    const QStringList apps = Kickoff::systemApplicationList();
+    d->appsList.clear();
+
+    foreach (const QString &app, apps) {
+        KService::Ptr service = KService::serviceByStorageId(app);
+
+        if (service) {
+            d->appsList << service;
+        }
+    }
+}
+
 void Kickoff::SystemModel::sourceDataChanged(const QModelIndex &start, const QModelIndex &end)
 {
     if (start.parent().isValid()) return;
--- workspace/plasma/desktop/applets/kickoff/core/systemmodel.h	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/desktop/applets/kickoff/core/systemmodel.h	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -48,13 +48,12 @@
     virtual int columnCount(const QModelIndex &parent = QModelIndex()) const;
     virtual QVariant data(const QModelIndex &index, int role = Qt::DisplayRole) const;
     virtual QVariant headerData(int section, Qt::Orientation orientation, int role = Qt::DisplayRole) const;
+    void refreshUsageInfo();
+    void stopRefreshingUsageInfo();
 
 private Q_SLOTS:
-    void startRefreshingUsageInfo();
+    void refreshNextUsageInfo();
     void reloadApplications();
-    void freeSpaceInfoAvailable(const QString& mountPoint, quint64 kbSize,
-                                quint64 kbUsed, quint64 kbAvailable);
-
     void sourceDataChanged(const QModelIndex &start, const QModelIndex &end);
     void sourceRowsAboutToBeInserted(const QModelIndex &parent, int start, int end);
     void sourceRowsInserted(const QModelIndex &parent, int start, int end);
--- workspace/plasma/desktop/applets/kickoff/ui/launcher.cpp	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/desktop/applets/kickoff/ui/launcher.cpp	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -228,7 +228,7 @@
 
     void setupSystemView()
     {
-        SystemModel *model = new SystemModel(q);
+        systemModel = new SystemModel(q);
         UrlItemView *view = new UrlItemView();
         ItemDelegate *delegate = new ItemDelegate(q);
         delegate->setRoleMapping(Plasma::Delegate::SubTitleRole, SubTitleRole);
@@ -236,7 +236,7 @@
         view->setItemDelegate(delegate);
         view->setItemStateProvider(delegate);
 
-        addView(i18n("Computer"), systemIcon(), model, view);
+        addView(i18n("Computer"), systemIcon(), systemModel, view);
     }
 
     void setupSearchView()
@@ -448,6 +448,7 @@
     ApplicationModel  *applicationModel;
     RecentlyUsedModel *recentlyUsedModel;
     KRunnerModel *searchModel;
+    SystemModel *systemModel;
     LeaveModel *leaveModel;
     SearchBar *searchBar;
     QWidget *footer;
@@ -807,6 +808,7 @@
 {
     Q_UNUSED(event)
     reset();
+    d->systemModel->stopRefreshingUsageInfo();
 }
 
 void Launcher::keyPressEvent(QKeyEvent *event)
@@ -828,6 +830,7 @@
 void Launcher::showEvent(QShowEvent *e)
 {
     d->searchBar->setFocus();
+    d->systemModel->refreshUsageInfo();
 
     QWidget::showEvent(e);
 }
--- workspace/plasma/generic/dataengines/weather/ions/wetter.com/ion_wettercom.cpp	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/generic/dataengines/weather/ions/wetter.com/ion_wettercom.cpp	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -52,8 +52,12 @@
 void WetterComIon::cleanup()
 {
     // Clean up dynamically allocated forecasts
-    foreach (const WeatherData &item, m_weatherData) {
+    QMutableHashIterator<QString, WeatherData> it(m_weatherData);
+    while (it.hasNext()) {
+        it.next();
+        WeatherData &item = it.value();
         qDeleteAll(item.forecasts);
+        item.forecasts.clear();
     }
 }
 
--- workspace/plasma/generic/dataengines/weather/ions/envcan/ion_envcan.cpp	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/generic/dataengines/weather/ions/envcan/ion_envcan.cpp	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -32,27 +32,26 @@
 {
 }
 
-void EnvCanadaIon::reset()
+void EnvCanadaIon::deleteForecasts()
 {
-    foreach(const WeatherData &item, m_weatherData) {
-        foreach(WeatherData::WeatherEvent *warning, item.warnings) {
-            if (warning) {
-                delete warning;
-            }
-        }
+    QMutableHashIterator<QString, WeatherData> it(m_weatherData);
+    while (it.hasNext()) {
+        it.next();
+        WeatherData &item = it.value();
+        qDeleteAll(item.warnings);
+        item.warnings.clear();
 
-        foreach(WeatherData::WeatherEvent *watch, item.watches) {
-            if (watch) {
-                delete watch;
-            }
-        }
+        qDeleteAll(item.watches);
+        item.watches.clear();
 
-        foreach(WeatherData::ForecastInfo *forecast, item.forecasts) {
-            if (forecast) {
-                delete forecast;
-            }
-        }
+        qDeleteAll(item.forecasts);
+        item.forecasts.clear();
     }
+}
+
+void EnvCanadaIon::reset()
+{
+    deleteForecasts();
     setInitialized(false);
     emitWhenSetup = true;
     redoXMLSetup();
@@ -61,25 +60,7 @@
 EnvCanadaIon::~EnvCanadaIon()
 {
     // Destroy each watch/warning stored in a QVector
-    foreach(const WeatherData &item, m_weatherData) {
-        foreach(WeatherData::WeatherEvent *warning, item.warnings) {
-            if (warning) {
-                delete warning;
-            }
-        }
-
-        foreach(WeatherData::WeatherEvent *watch, item.watches) {
-            if (watch) {
-                delete watch;
-            }
-        }
-
-        foreach(WeatherData::ForecastInfo *forecast, item.forecasts) {
-            if (forecast) {
-                delete forecast;
-            }
-        }
-    }
+    deleteForecasts();
 }
 
 // Get the master list of locations to be parsed
@@ -1489,18 +1470,22 @@
     // This will always return Canada
     return m_weatherData[source].countryName;
 }
+
 QString EnvCanadaIon::territory(const QString& source) const
 {
     return m_weatherData[source].shortTerritoryName;
 }
+
 QString EnvCanadaIon::city(const QString& source) const
 {
     return m_weatherData[source].cityName;
 }
+
 QString EnvCanadaIon::region(const QString& source) const
 {
     return m_weatherData[source].regionName;
 }
+
 QString EnvCanadaIon::station(const QString& source) const
 {
     if (!m_weatherData[source].stationID.isEmpty()) {
--- workspace/plasma/generic/dataengines/weather/ions/envcan/ion_envcan.h	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/generic/dataengines/weather/ions/envcan/ion_envcan.h	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -163,6 +163,7 @@
 
 private:
     /* Environment Canada Methods - Internal for Ion */
+    void deleteForecasts();
 
     QMap<QString, ConditionIcons> setupConditionIconMappings(void) const;
     QMap<QString, ConditionIcons> setupForecastIconMappings(void) const;
--- workspace/plasma/generic/dataengines/weather/ions/bbcukmet/ion_bbcukmet.cpp	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/generic/dataengines/weather/ions/bbcukmet/ion_bbcukmet.cpp	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -34,32 +34,29 @@
 
 UKMETIon::~UKMETIon()
 {
-    // Destroy each forecast stored in a QVector
-    foreach(const WeatherData &item, m_weatherData) {
-        foreach(WeatherData::ForecastInfo *forecast, item.forecasts) {
-            if (forecast) {
-                delete forecast;
-            }
-        }
-    }
+    deleteForecasts();
 }
 
 void UKMETIon::reset()
 {
-    // Destroy each forecast stored in a QVector
-    foreach(const WeatherData &item, m_weatherData) {
-        foreach(WeatherData::ForecastInfo *forecast, item.forecasts) {
-            if (forecast) {
-                delete forecast;
-            }
-        }
-    }
-
+    deleteForecasts();
     emit(resetCompleted(this, true));
 }
 
 
+void UKMETIon::deleteForecasts()
+{
+    // Destroy each forecast stored in a QVector
+    QHash<QString, WeatherData>::iterator
+        it = m_weatherData.begin(),
+        end = m_weatherData.end();
+    for (; it != end; ++it) {
+        qDeleteAll(it.value().forecasts);
+        it.value().forecasts.clear();
+    }
+}
 
+
 // Get the master list of locations to be parsed
 void UKMETIon::init()
 {
--- workspace/plasma/generic/dataengines/weather/ions/bbcukmet/ion_bbcukmet.h	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/generic/dataengines/weather/ions/bbcukmet/ion_bbcukmet.h	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -170,6 +170,7 @@
 
     QDateTime m_dateFormat;
 
+    void deleteForecasts();
 };
 
 K_EXPORT_PLASMA_DATAENGINE(bbcukmet, UKMETIon)
--- workspace/plasma/generic/applets/devicenotifier/devicenotifier.cpp	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/generic/applets/devicenotifier/devicenotifier.cpp	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -80,11 +80,8 @@
 
 void DeviceNotifier::init()
 {
-    KConfigGroup cg = config();
-    m_numberItems = cg.readEntry("NumberItems", 4);
-    m_itemsValidity = cg.readEntry("ItemsValidity", 5);
-    m_showDevices = cg.readEntry("ShowDevices", (int)RemovableOnly);
-
+    configChanged();
+    
     m_solidEngine = dataEngine("hotplug");
     m_solidDeviceEngine = dataEngine("soliddevice");
 
@@ -94,7 +91,7 @@
 
     setPopupIcon(DEFAULT_ICON_NAME);
 
-    //connect to engine when a device is plug
+    //connect to engine when a device is plugged in
     connect(m_solidEngine, SIGNAL(sourceAdded(const QString&)),
             this, SLOT(onSourceAdded(const QString&)));
     connect(m_solidEngine, SIGNAL(sourceRemoved(const QString&)),
@@ -110,6 +107,14 @@
     }
 }
 
+void DeviceNotifier::configChanged()
+{
+    KConfigGroup cg = config();
+    m_numberItems = cg.readEntry("NumberItems", 4);
+    m_itemsValidity = cg.readEntry("ItemsValidity", 5);
+    m_showDevices = cg.readEntry("ShowDevices", (int)RemovableOnly);
+}
+
 QGraphicsWidget *DeviceNotifier::graphicsWidget()
 {
     if (!m_dialog) {
--- workspace/plasma/generic/applets/devicenotifier/devicenotifier.h	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/generic/applets/devicenotifier/devicenotifier.h	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -112,6 +112,11 @@
 
     public slots:
         /**
+        * Reimplemented from Plasma::Applet
+        **/
+        void configChanged();
+        
+        /**
         * @internal Sets the tooltip content properly before showing.
         */
         void toolTipAboutToShow();
--- workspace/plasma/generic/applets/lock_logout/lockout.cpp	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/generic/applets/lock_logout/lockout.cpp	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -65,14 +65,6 @@
     m_layout->setContentsMargins(0,0,0,0);
     m_layout->setSpacing(0);
 
-#ifndef Q_OS_WIN
-    KConfigGroup cg = config();
-    m_showLockButton = cg.readEntry("showLockButton", true);
-    m_showLogoutButton = cg.readEntry("showLogoutButton", true);
-    m_showSleepButton = cg.readEntry("showSleepButton", false);
-    m_showHibernateButton = cg.readEntry("showHibernateButton", false);
-#endif
-
     //Tooltip strings maybe should be different (eg. "Leave..."->"Logout")?
     m_iconLock = new Plasma::IconWidget(KIcon("system-lock-screen"), "", this);
     connect(m_iconLock, SIGNAL(clicked()), this, SLOT(clickLock()));
@@ -94,6 +86,19 @@
     Plasma::ToolTipContent hibernateToolTip(i18n("Hibernate"),i18n("Hibernate (suspend to disk)"),m_iconHibernate->icon());
     Plasma::ToolTipManager::self()->setContent(m_iconHibernate, hibernateToolTip);
    
+    configChanged();
+}
+
+void LockOut::configChanged()
+{
+    #ifndef Q_OS_WIN
+        KConfigGroup cg = config();
+        m_showLockButton = cg.readEntry("showLockButton", true);
+        m_showLogoutButton = cg.readEntry("showLogoutButton", true);
+        m_showSleepButton = cg.readEntry("showSleepButton", false);
+        m_showHibernateButton = cg.readEntry("showHibernateButton", false);
+    #endif
+    
     countButtons();
     showButtons();
 }
--- workspace/plasma/generic/applets/lock_logout/lockout.h	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/generic/applets/lock_logout/lockout.h	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -45,6 +45,7 @@
         virtual void constraintsEvent(Plasma::Constraints constraints);
 
     public slots:
+        void configChanged();
         void clickLogout();
         void clickLock();
         void clickSleep();
--- workspace/plasma/generic/applets/webbrowser/webbrowser.cpp	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/generic/applets/webbrowser/webbrowser.cpp	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -83,9 +83,6 @@
         return m_graphicsWidget;
     }
 
-    KConfigGroup cg = config();
-
-
     m_layout = new QGraphicsLinearLayout(Qt::Vertical);
     m_toolbarLayout = new QGraphicsLinearLayout(Qt::Horizontal);
     m_statusbarLayout = new QGraphicsLinearLayout(Qt::Horizontal);
@@ -110,11 +107,9 @@
 
     m_layout->addItem(m_toolbarLayout);
 
-
     m_browser = new Plasma::WebView(this);
     m_browser->setPreferredSize(400, 400);
     m_browser->setSizePolicy(QSizePolicy::Expanding, QSizePolicy::Expanding);
-    m_browser->setDragToScroll(cg.readEntry("DragToScroll", false));
 
 
     m_layout->addItem(m_browser);
@@ -164,27 +159,10 @@
     m_zoom->setMaximumWidth(0);
     m_statusbarLayout->addItem(m_zoom);
 
-    if (!m_url.isValid()) {
-        m_url = KUrl(cg.readEntry("Url", "http://www.kde.org"));
-        m_verticalScrollValue = cg.readEntry("VerticalScrollValue", 0);
-        m_horizontalScrollValue = cg.readEntry("HorizontalScrollValue", 0);
-        int value = cg.readEntry("Zoom", 1);
-        m_zoom->setValue(value);
-        m_browser->mainFrame()->setZoomFactor((qreal)0.2 + ((qreal)value/(qreal)50));
-    }
     connect(m_zoom, SIGNAL(valueChanged(int)), this, SLOT(zoom(int)));
     m_browser->setUrl(m_url);
     m_browser->update();
 
-    m_autoRefresh = cg.readEntry("autoRefresh", false);
-    m_autoRefreshInterval = qMax(2, cg.readEntry("autoRefreshInterval", 5));
-
-    if (m_autoRefresh) {
-        m_autoRefreshTimer = new QTimer(this);
-        m_autoRefreshTimer->start(m_autoRefreshInterval*60*1000);
-        connect(m_autoRefreshTimer, SIGNAL(timeout()), this, SLOT(reload()));
-    }
-
     connect(m_back->action(), SIGNAL(triggered()), this, SLOT(back()));
     connect(m_forward->action(), SIGNAL(triggered()), this, SLOT(forward()));
     connect(m_reloadAction, SIGNAL(triggered()), this, SLOT(reload()));
@@ -206,15 +184,13 @@
     m_completion = new KCompletion();
     m_nativeHistoryCombo->setCompletionObject(m_completion);
 
-    QStringList list = cg.readEntry("History list", QStringList());
-    m_nativeHistoryCombo->setHistoryItems(list);
-
     m_graphicsWidget = new QGraphicsWidget(this);
     m_graphicsWidget->setLayout(m_layout);
 
     m_back->setEnabled(m_browser->page()->history()->canGoBack());
     m_forward->setEnabled(m_browser->page()->history()->canGoForward());
 
+    configChanged();
 
     return m_graphicsWidget;
 }
@@ -247,6 +223,34 @@
     fillGroup(0, m_bookmarkManager->root());
 }
 
+void WebBrowser::configChanged()
+{
+    KConfigGroup cg = config();
+    
+    m_browser->setDragToScroll(cg.readEntry("DragToScroll", false));
+    
+    if (!m_url.isValid()) {
+        m_url = KUrl(cg.readEntry("Url", "http://www.kde.org"));
+        m_verticalScrollValue = cg.readEntry("VerticalScrollValue", 0);
+        m_horizontalScrollValue = cg.readEntry("HorizontalScrollValue", 0);
+        int value = cg.readEntry("Zoom", 1);
+        m_zoom->setValue(value);
+        m_browser->mainFrame()->setZoomFactor((qreal)0.2 + ((qreal)value/(qreal)50));
+    }
+    
+    m_autoRefresh = cg.readEntry("autoRefresh", false);
+    m_autoRefreshInterval = qMax(2, cg.readEntry("autoRefreshInterval", 5));
+    
+    if (m_autoRefresh) {
+        m_autoRefreshTimer = new QTimer(this);
+        m_autoRefreshTimer->start(m_autoRefreshInterval*60*1000);
+        connect(m_autoRefreshTimer, SIGNAL(timeout()), this, SLOT(reload()));
+    }
+        
+    QStringList list = cg.readEntry("History list", QStringList());
+    m_nativeHistoryCombo->setHistoryItems(list);
+}
+
 void WebBrowser::fillGroup(BookmarkItem *parentItem, const KBookmarkGroup &group)
 {
     KBookmark it = group.first();
--- workspace/plasma/generic/applets/webbrowser/webbrowser.h	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/generic/applets/webbrowser/webbrowser.h	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -90,7 +90,8 @@
     void loadProgress(int progress);
     void bookmarksModelInit();
     void configAccepted();
-
+    void configChanged();
+    
 private:
     void fillGroup(BookmarkItem *parentItem, const KBookmarkGroup &group);
 
--- workspace/plasma/generic/applets/systemtray/ui/taskarea.cpp	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/generic/applets/systemtray/ui/taskarea.cpp	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -68,6 +68,7 @@
 
     QSet<QString> hiddenTypes;
     QSet<QString> alwaysShownTypes;
+    QSet<SystemTray::Task*> hiddenTasks;
     bool showingHidden : 1;
     bool hasHiddenTasks : 1;
     bool hasTasksThatCanHide : 1;
@@ -199,9 +200,20 @@
         }
         return;
     }
-
-    d->hasTasksThatCanHide = d->hasTasksThatCanHide || (task->hidden() != Task::NotHidden);
-
+    
+    // keep track of the hidden tasks
+    // needs to be done because if a tasks is added multiple times (like when coming out of sleep)
+    // it may be autohidden for a while until the final one which will not be hidden
+    // therefore we need a way to track the hidden tasks
+    // if the task appears in the hidden list, then we know there are hidden tasks
+    if (task->hidden() != Task::NotHidden) {
+        d->hiddenTasks << task;
+    } else {
+        d->hiddenTasks.remove(task);
+    }
+    
+    d->hasTasksThatCanHide = !d->hiddenTasks.isEmpty();
+    
     if (!d->showingHidden && task->hidden() != Task::NotHidden && !d->alwaysShownTypes.contains(task->typeId())) {
         kDebug() << "is a hidden type";
         d->hasHiddenTasks = true;
@@ -248,6 +260,9 @@
 
 void TaskArea::removeTask(Task *task)
 {
+    d->hiddenTasks.remove(task);
+    d->hasTasksThatCanHide = !d->hiddenTasks.isEmpty();
+    
     QGraphicsWidget *widget = task->widget(d->host, false);
 
     if (widget) {
@@ -257,6 +272,7 @@
         d->lastTasksLayout->removeItem(widget);
         relayout();
     } else {
+        //this is not a typo
         relayout();relayout();
         QTimer::singleShot(200, this, SLOT(relayout()));
     }
--- workspace/plasma/generic/applets/system-monitor/hdd.h	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/generic/applets/system-monitor/hdd.h	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -42,6 +42,7 @@
         virtual void createConfigurationInterface(KConfigDialog *parent);
 
     public slots:
+        void configChanged();
         void dataUpdated(const QString &name, const Plasma::DataEngine::Data &data);
 
     private slots:
--- workspace/plasma/generic/applets/system-monitor/ram.cpp	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/generic/applets/system-monitor/ram.cpp	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -44,10 +44,10 @@
 void SM::Ram::init()
 {
     KGlobal::locale()->insertCatalog("plasma_applet_system-monitor");
-    KConfigGroup cg = config();
     setEngine(dataEngine("systemmonitor"));
-    setInterval(cg.readEntry("interval", 2.0) * 1000);
     setTitle(i18n("RAM"));
+    
+    configChanged();
 
     /* At the time this method is running, not all source may be connected. */
     connect(engine(), SIGNAL(sourceAdded(const QString&)),
@@ -57,6 +57,12 @@
     }
 }
 
+void SM::Ram::configChanged()
+{
+    KConfigGroup cg = config();
+    setInterval(cg.readEntry("interval", 2.0) * 1000);
+}
+
 void SM::Ram::sourceAdded(const QString& name)
 {
     if ((name == phys_source || name == swap_source) && !m_memories.contains(name)) {
--- workspace/plasma/generic/applets/system-monitor/net.cpp	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/generic/applets/system-monitor/net.cpp	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -42,11 +42,11 @@
 void SM::Net::init()
 {
     KGlobal::locale()->insertCatalog("plasma_applet_system-monitor");
-    KConfigGroup cg = config();
     setEngine(dataEngine("systemmonitor"));
-    setInterval(cg.readEntry("interval", 2.0) * 1000);
     setTitle(i18n("Network"));
 
+    configChanged();
+    
     connect(engine(), SIGNAL(sourceAdded(const QString&)),
             this, SLOT(sourceAdded(const QString&)));
     connect(engine(), SIGNAL(sourceRemoved(const QString&)),
@@ -58,6 +58,12 @@
     }
 }
 
+void SM::Net::configChanged()
+{
+    KConfigGroup cg = config();
+    setInterval(cg.readEntry("interval", 2.0) * 1000);
+}
+
 void SM::Net::sourceAdded(const QString& name)
 {
     if (m_rx.indexIn(name) != -1) {
--- workspace/plasma/generic/applets/system-monitor/hdd.cpp	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/generic/applets/system-monitor/hdd.cpp	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -41,20 +41,28 @@
 void Hdd::init()
 {
     KGlobal::locale()->insertCatalog("plasma_applet_system-monitor");
-    KConfigGroup cg = config();
     QString predicateString("IS StorageVolume");
     setEngine(dataEngine("soliddevice"));
+
+    setTitle(i18n("Disk Space"), true);
+    
+    configChanged();
+    connectToEngine();
+}
+
+void Hdd::configChanged()
+{
+    KConfigGroup cg = config();
+    
     QStringList items = cg.readEntry("uuids", QStringList());
     if (items.isEmpty()) {
         items = mounted();
     }
+    
     setItems(items);
     setInterval(cg.readEntry("interval", 2) * 60 * 1000);
-
-    setTitle(i18n("Disk Space"), true);
-    connectToEngine();
 }
-
+        
 QStringList Hdd::mounted()
 {
     Plasma::DataEngine::Data data;
--- workspace/plasma/generic/applets/system-monitor/temperature.h	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/generic/applets/system-monitor/temperature.h	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -39,6 +39,7 @@
         virtual void init();
 
     public slots:
+        void configChanged();
         void dataUpdated(const QString &name, const Plasma::DataEngine::Data &data);
         void createConfigurationInterface(KConfigDialog *parent);
 
--- workspace/plasma/generic/applets/system-monitor/ram.h	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/generic/applets/system-monitor/ram.h	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -45,6 +45,7 @@
         void sourceAdded(const QString &name);
         void sourcesAdded();
         void configAccepted();
+        void configChanged();
 
     private:
         Ui::config ui;
--- workspace/plasma/generic/applets/system-monitor/net.h	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/generic/applets/system-monitor/net.h	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -43,6 +43,7 @@
 
     public slots:
         void configAccepted();
+        void configChanged();
         void dataUpdated(const QString &name,
                          const Plasma::DataEngine::Data &data);
         void sourceAdded(const QString &name);
--- workspace/plasma/generic/applets/system-monitor/temperature.cpp	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/generic/applets/system-monitor/temperature.cpp	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -51,11 +51,11 @@
 void Temperature::init()
 {
     KGlobal::locale()->insertCatalog("plasma_applet_system-monitor");
-    KConfigGroup cg = config();
     setEngine(dataEngine("systemmonitor"));
-    setInterval(cg.readEntry("interval", 2.0) * 1000);
     setTitle(i18n("Temperature"));
 
+    configChanged();
+    
     /* At the time this method is running, not all source may be connected. */
     connect(engine(), SIGNAL(sourceAdded(QString)), this, SLOT(sourceAdded(const QString)));
     foreach (const QString& source, engine()->sources()) {
@@ -63,6 +63,12 @@
     }
 }
 
+void Temperature::configChanged()
+{
+    KConfigGroup cg = config();
+    setInterval(cg.readEntry("interval", 2.0) * 1000);
+}
+
 void Temperature::sourceAdded(const QString& name)
 {
     if (m_rx.indexIn(name) != -1) {
--- workspace/plasma/generic/applets/analog-clock/clock.h	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/generic/applets/analog-clock/clock.h	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -63,6 +63,7 @@
 
     protected slots:
         void clockConfigAccepted();
+        void clockConfigChanged();
         void repaintNeeded();
         void moveSecondHand();
 
--- workspace/plasma/generic/applets/analog-clock/clock.cpp	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/generic/applets/analog-clock/clock.cpp	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -80,36 +80,42 @@
 {
     ClockApplet::init();
 
+    configChanged();
+    
+    invalidateCache();
+}
+
+void Clock::connectToEngine()
+{
+    m_lastTimeSeen = QTime();
+
+    Plasma::DataEngine* timeEngine = dataEngine("time");
+    if (m_showSecondHand) {
+        timeEngine->connectSource(currentTimezone(), this, 500);
+    } else {
+        timeEngine->connectSource(currentTimezone(), this, 6000, Plasma::AlignToMinute);
+    }
+}
+
+void Clock::clockConfigChanged()
+{
     KConfigGroup cg = config();
     m_showSecondHand = cg.readEntry("showSecondHand", false);
     m_showTimezoneString = cg.readEntry("showTimezoneString", false);
     m_showingTimezone = m_showTimezoneString;
     m_fancyHands = cg.readEntry("fancyHands", false);
     setCurrentTimezone(cg.readEntry("timezone", localTimezone()));
-
+    
     if (m_showSecondHand) {
         //We don't need to cache the applet if it update every seconds
-        setCacheMode(QGraphicsItem::NoCache);
+                        setCacheMode(QGraphicsItem::NoCache);
     } else {
         setCacheMode(QGraphicsItem::DeviceCoordinateCache);
     }
 
     connectToEngine();
-    invalidateCache();
 }
 
-void Clock::connectToEngine()
-{
-    m_lastTimeSeen = QTime();
-
-    Plasma::DataEngine* timeEngine = dataEngine("time");
-    if (m_showSecondHand) {
-        timeEngine->connectSource(currentTimezone(), this, 500);
-    } else {
-        timeEngine->connectSource(currentTimezone(), this, 6000, Plasma::AlignToMinute);
-    }
-}
-
 void Clock::constraintsEvent(Plasma::Constraints constraints)
 {
     ClockApplet::constraintsEvent(constraints);
--- workspace/plasma/generic/applets/panelspacer/panelspacer.h	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/generic/applets/panelspacer/panelspacer.h	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -34,6 +34,9 @@
     void constraintsEvent(Plasma::Constraints constraints);
     QList<QAction*> contextualActions();
 
+public slots:
+    void configChanged();
+    
 private Q_SLOTS:
     void updateConfigurationMode(bool config);
     void toggleFixed(bool flexible);
--- workspace/plasma/generic/applets/panelspacer/panelspacer.cpp	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/generic/applets/panelspacer/panelspacer.cpp	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -73,13 +73,19 @@
     if (containment()) {
         connect(containment(), SIGNAL(toolBoxVisibilityChanged(bool)), this, SLOT(updateConfigurationMode(bool)));
     }
+    
+    configChanged();
+}
 
+void PanelSpacer::configChanged()
+{
+    kDebug();
     m_fixedSize = config().readEntry("FixedSize", false);
     toggleFixed(!m_fixedSize);
     QAction *fixedAction = action("toggle fixed");
     if (fixedAction) {
         fixedAction->setChecked(!m_fixedSize);
-    }
+    }    
 }
 
 void PanelSpacer::constraintsEvent(Plasma::Constraints constraints)
--- workspace/plasma/generic/runners/bookmarks/bookmarksrunner.cpp	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/generic/runners/bookmarks/bookmarksrunner.cpp	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -55,6 +55,10 @@
 
 BookmarksRunner::~BookmarksRunner()
 {
+    QFile db_CacheFile(m_dbCacheFile);
+    if (db_CacheFile.exists()) {
+        kDebug() << "Cache file was removed: " << db_CacheFile.remove();
+    }
 }
 
 void BookmarksRunner::reloadConfiguration()
@@ -109,24 +113,25 @@
     m_browser = whichBrowser();
     if (m_browser == Firefox) {
         if (m_db.isValid()) {
-            kDebug() << "Cache file was removed: " << QFile(m_dbCacheFile).remove();
-            kDebug() << "Database was copyed: " << QFile(m_dbFile).copy(m_dbCacheFile);
-            m_db.setDatabaseName(m_dbCacheFile);
-            m_dbOK = m_db.open();
-            kDebug() << "Database was opened: " << m_dbOK;
+            KIO::Job *job = KIO::file_copy(m_dbFile, m_dbCacheFile, -1,
+                                           KIO::HideProgressInfo | KIO::Overwrite);
+            connect(job, SIGNAL(result(KJob*)), this, SLOT(dbCopied(KJob*)));
         }
     }
 }
 
+void BookmarksRunner::dbCopied(KJob *)
+{
+    m_db.setDatabaseName(m_dbCacheFile);
+    m_dbOK = m_db.open();
+    //kDebug() << "Database was opened: " << m_dbOK;
+}
+
 void BookmarksRunner::down()
 {
     if (m_db.isOpen()) {
         m_db.close();
         m_dbOK = false;
-        QFile db_CacheFile(m_dbCacheFile);
-        if (db_CacheFile.exists()) {
-            kDebug() << "Cache file was removed: " << db_CacheFile.remove();
-        }
     }
 }
 
--- workspace/plasma/generic/runners/bookmarks/bookmarksrunner.h	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/generic/runners/bookmarks/bookmarksrunner.h	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -27,6 +27,7 @@
 
 class KBookmark;
 class KBookmarkManager;
+class KJob;
 
 /** This runner searchs for bookmarks in browsers like Konqueror and Firefox */
 class BookmarksRunner : public Plasma::AbstractRunner
@@ -82,6 +83,7 @@
     private Q_SLOTS:
         void prep();
         void down();
+        void dbCopied(KJob *);
 };
 
 K_EXPORT_PLASMA_RUNNER(bookmarksrunner, BookmarksRunner)
--- workspace/plasma/generic/runners/windows/windowsrunner.cpp	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/generic/runners/windows/windowsrunner.cpp	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -18,6 +18,8 @@
  ***************************************************************************/
 #include "windowsrunner.h"
 
+#include <QTimer>
+
 #include <KDebug>
 #include <KIcon>
 #include <KWindowSystem>
@@ -28,7 +30,9 @@
 #endif
 
 WindowsRunner::WindowsRunner(QObject* parent, const QVariantList& args)
-    : AbstractRunner(parent, args)
+    : AbstractRunner(parent, args),
+      m_inSession(false),
+      m_ready(false)
 {
     Q_UNUSED(args)
     setObjectName("Windows");
@@ -57,8 +61,12 @@
 {
 }
 
-void WindowsRunner::prepareForMatchSession()
+void WindowsRunner::gatherInfo()
 {
+    if (!m_inSession) {
+        return;
+    }
+
     foreach (const WId w, KWindowSystem::windows()) {
         KWindowInfo info = KWindowSystem::windowInfo(w, NET::WMWindowType | NET::WMDesktop |
                                                         NET::WMState | NET::XAWMState |
@@ -79,13 +87,25 @@
             m_icons.insert(w, QIcon(KWindowSystem::icon(w)));
         }
     }
+
     for (int i=1; i<=KWindowSystem::numberOfDesktops(); i++) {
         m_desktopNames << KWindowSystem::desktopName(i);
     }
+
+    m_ready = true;
 }
 
+void WindowsRunner::prepareForMatchSession()
+{
+    m_inSession = true;
+    m_ready = false;
+    QTimer::singleShot(0, this, SLOT(gatherInfo()));
+}
+
 void WindowsRunner::matchSessionComplete()
 {
+    m_inSession = false;
+    m_ready = false;
     m_desktopNames.clear();
     m_icons.clear();
     m_windows.clear();
@@ -93,6 +113,10 @@
 
 void WindowsRunner::match(Plasma::RunnerContext& context)
 {
+    if (!m_ready) {
+        return;
+    }
+
     QString term = context.query();
 
     if (!context.singleRunnerQueryMode() && (term.length() < 3)) {
--- workspace/plasma/generic/runners/windows/windowsrunner.h	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/generic/runners/windows/windowsrunner.h	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -37,6 +37,7 @@
     private Q_SLOTS:
         void prepareForMatchSession();
         void matchSessionComplete();
+        void gatherInfo();
 
     private:
         enum WindowAction {
@@ -57,6 +58,9 @@
         QHash<WId, KWindowInfo> m_windows;
         QHash<WId, QIcon> m_icons;
         QStringList m_desktopNames;
+
+        bool m_inSession : 1;
+        bool m_ready : 1;
 };
 
 K_EXPORT_PLASMA_RUNNER(windows, WindowsRunner)
--- workspace/plasma/generic/runners/kill/killrunner.cpp	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/generic/runners/kill/killrunner.cpp	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -18,17 +18,19 @@
  */
 
 #include "killrunner.h"
-#include "killrunner_config.h"
-#include "ksysguard/processcore/processes.h"
-#include "ksysguard/processcore/process.h"
 
+#include <QAction>
+
 #include <KDebug>
 #include <KIcon>
 #include <KProcess>
 #include <KUser>
 
-#include <QAction>
+#include "ksysguard/processcore/processes.h"
+#include "ksysguard/processcore/process.h"
 
+#include "killrunner_config.h"
+
 KillRunner::KillRunner(QObject *parent, const QVariantList& args)
         : Plasma::AbstractRunner(parent, args),
           m_processes(0)
@@ -39,6 +41,10 @@
 
     connect(this, SIGNAL(prepare()), this, SLOT(prep()));
     connect(this, SIGNAL(teardown()), this, SLOT(cleanup()));
+
+    m_delayedCleanupTimer.setInterval(50);
+    m_delayedCleanupTimer.setSingleShot(true);
+    connect(&m_delayedCleanupTimer, SIGNAL(timeout()), this, SLOT(cleanup()));
 }
 
 KillRunner::~KillRunner()
@@ -63,17 +69,25 @@
 
 void KillRunner::prep()
 {
-    if (!m_processes) {
-        m_processes = KSysGuard::Processes::getInstance();
-    }
+    m_delayedCleanupTimer.stop();
 }
 
 void KillRunner::cleanup()
 {
-    if (m_processes) {
-        KSysGuard::Processes::returnInstance();
-        m_processes = 0;
+    if (!m_processes) {
+        return;
     }
+
+    if (m_prepLock.tryLockForWrite()) {
+        if (m_processes) {
+            KSysGuard::Processes::returnInstance();
+            m_processes = 0;
+        }
+
+        m_prepLock.unlock();
+    } else {
+        m_delayedCleanupTimer.stop();
+    }
 }
 
 void KillRunner::match(Plasma::RunnerContext &context)
@@ -84,6 +98,16 @@
         return;
     }
 
+    m_prepLock.lockForRead();
+    if (!m_processes) {
+        m_prepLock.unlock();
+        m_prepLock.lockForWrite();
+        if (!m_processes) {
+            m_processes = KSysGuard::Processes::getInstance();
+        }
+    }
+    m_prepLock.unlock();
+
     term = term.right(term.length() - m_triggerWord.length());
 
     if (term.length() < 2)  {
--- workspace/plasma/generic/runners/kill/killrunner.h	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/generic/runners/kill/killrunner.h	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -20,8 +20,12 @@
 #ifndef KILLRUNNER_H
 #define KILLRUNNER_H
 
+#include <QReadWriteLock>
+#include <QTimer>
+
+#include <Plasma/AbstractRunner>
+
 #include "killrunner_config.h"
-#include <plasma/abstractrunner.h>
 class QAction;
 
 namespace KSysGuard
@@ -61,6 +65,12 @@
 
     /** process lister */
     KSysGuard::Processes *m_processes;
+
+    /** lock for initializing m_processes */
+    QReadWriteLock m_prepLock;
+
+    /** timer for retrying the cleanup due to lock contention */
+    QTimer m_delayedCleanupTimer;
 };
 K_EXPORT_PLASMA_RUNNER(kill, KillRunner)
 
--- workspace/plasma/generic/scriptengines/python/pyappletscript.py	(.../tags/KDE/4.4.0/kdebase)	(wersja 1090080)
+++ workspace/plasma/generic/scriptengines/python/pyappletscript.py	(.../branches/KDE/4.4/kdebase)	(wersja 1090080)
@@ -57,7 +57,12 @@
             relpath = relpath[:-3]
         relpath = relpath.replace("/",".")
         self.module = __import__(self.pluginName+'.'+relpath)
-        self.pyapplet = self.module.main.CreateApplet(None)
+
+        # Plasma main scripts not necessarily are named "main"
+        # So we use __dict__ to get the right main script name
+        basename = os.path.basename(str(self.mainScript()))
+        basename = os.path.splitext(basename)[0]
+        self.pyapplet = self.module.__dict__[basename].CreateApplet(None)
         self.pyapplet.setApplet(self.applet())
         self.pyapplet.setAppletScript(self)
         self.connect(self.applet(), SIGNAL('extenderItemRestored(Plasma::ExtenderItem*)'),
